<html><head><meta charset="utf-8" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><meta content="width=device-width, initial-scale=1" name="viewport" /><title>with-redefs</title><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700" rel="stylesheet" /><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet" /><link href="/css/normalize.css" rel="stylesheet" /><link href="/css/skeleton.css" rel="stylesheet" /><link href="/css/custom.css" rel="stylesheet" /><link href="/css/github-theme.css" rel="stylesheet" /><link href="/img/icons/apple-touch-icon-57x57.png" rel="apple-touch-icon" sizes="57x57" /><link href="/img/icons/apple-touch-icon-114x114.png" rel="apple-touch-icon" sizes="114x114" /><link href="/img/icons/apple-touch-icon-72x72.png" rel="apple-touch-icon" sizes="72x72" /><link href="/img/icons/apple-touch-icon-144x144.png" rel="apple-touch-icon" sizes="144x144" /><link href="/img/icons/apple-touch-icon-60x60.png" rel="apple-touch-icon" sizes="60x60" /><link href="/img/icons/apple-touch-icon-120x120.png" rel="apple-touch-icon" sizes="120x120" /><link href="/img/icons/apple-touch-icon-76x76.png" rel="apple-touch-icon" sizes="76x76" /><link href="/img/icons/apple-touch-icon-152x152.png" rel="apple-touch-icon" sizes="152x152" /><link href="/img/icons/apple-touch-icon-180x180.png" rel="apple-touch-icon" sizes="180x180" /><link href="/img/icons/favicon-192x192.png" rel="icon" sizes="192x192" type="image/png" /><link href="/img/icons/favicon-160x160.png" rel="icon" sizes="160x160" type="image/png" /><link href="/img/icons/favicon-96x96.png" rel="icon" sizes="96x96" type="image/png" /><link href="/img/icons/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" /><link href="/img/icons/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" /></head><body><div class="container"><nav class="navbar"><div class="container"><ul class="navbar-list"><li class="navbar-item"><a class="navbar-link-logo"><img class="navbar-logo" src="/img/cljs-white.svg" /></a></li><li class="navbar-item"><a class="navbar-title">ClojureScript</a></li><li class="navbar-item"><a class="navbar-link" href="/api">API</a></li><li class="navbar-item"><a class="navbar-link" href="https://github.com/clojure/clojurescript" target="_blank">GitHub</a></li></ul></div></nav><div><h1 class="r">with-redefs</h1><table><tr><td>macro</td><td>since v0.0-1806</td><td><a href="http://clojure.github.io/clojure/branch-master/clojure.core-api.html#clojure.core/with-redefs"><img height="24px" src="/img/clojure-icon.gif" valign="middle" /> clojure.core/with-redefs</a></td><td><a href="https://github.com/cljs/api/blob/master/docfiles/cljs.core/with-redefs.md">Edit</a></td></tr></table><div><code>(with-redefs bindings & body)</code></div><hr />Source docstring:<pre>binding => var-symbol temp-value-expr

Temporarily redefines vars while executing the body.  The
temp-value-exprs will be evaluated and each resulting value will
replace in parallel the root value of its var.  After the body is
executed, the root values of all the vars will be set back to their
old values. Useful for mocking out functions during testing.</pre><div>Source code @ <a href="https://github.com/clojure/clojurescript/blob/r1.11.51/src/main/clojure/cljs/core.cljc#L2252-L2274">clojurescript:src/main/clojure/cljs/core.cljc</a></div><pre><code class="syntax"><span class="s-exp">(</span><span class="symbol">core/defmacro</span> <span class="macro">with-redefs</span>
  <span class="s-exp">[</span><span class="symbol">bindings</span> <span class="reader-char">&</span> <span class="symbol">body</span><span class="s-exp">]</span>
  <span class="s-exp">(</span><span class="symbol">core/let</span> <span class="s-exp">[</span><span class="symbol">names</span> <span class="s-exp">(</span><span class="core-fn">take-nth</span> <span class="number">2</span> <span class="symbol">bindings</span><span class="s-exp">)</span>
             <span class="core-fn">vals</span> <span class="s-exp">(</span><span class="core-fn">take-nth</span> <span class="number">2</span> <span class="s-exp">(</span><span class="core-fn">drop</span> <span class="number">1</span> <span class="symbol">bindings</span><span class="s-exp">)</span><span class="s-exp">)</span>
             <span class="symbol">orig-val-syms</span> <span class="s-exp">(</span><span class="core-fn">map</span> <span class="s-exp">(</span><span class="core-fn">comp</span> <span class="core-fn">gensym</span> <span class="reader-char">#</span><span class="s-exp">(</span><span class="symbol">core/str</span> <span class="keyword">%</span> <span class="string">"-orig-val__"</span><span class="s-exp">)</span> <span class="core-fn">name</span><span class="s-exp">)</span> <span class="symbol">names</span><span class="s-exp">)</span>
             <span class="symbol">temp-val-syms</span> <span class="s-exp">(</span><span class="core-fn">map</span> <span class="s-exp">(</span><span class="core-fn">comp</span> <span class="core-fn">gensym</span> <span class="reader-char">#</span><span class="s-exp">(</span><span class="symbol">core/str</span> <span class="keyword">%</span> <span class="string">"-temp-val__"</span><span class="s-exp">)</span> <span class="core-fn">name</span><span class="s-exp">)</span> <span class="symbol">names</span><span class="s-exp">)</span>
             <span class="symbol">binds</span> <span class="s-exp">(</span><span class="core-fn">map</span> <span class="symbol">core/vector</span> <span class="symbol">names</span> <span class="symbol">temp-val-syms</span><span class="s-exp">)</span>
             <span class="symbol">resets</span> <span class="s-exp">(</span><span class="core-fn">reverse</span> <span class="s-exp">(</span><span class="core-fn">map</span> <span class="symbol">core/vector</span> <span class="symbol">names</span> <span class="symbol">orig-val-syms</span><span class="s-exp">)</span><span class="s-exp">)</span>
             <span class="symbol">bind-value</span> <span class="s-exp">(</span><span class="symbol">core/fn</span> <span class="s-exp">[</span><span class="s-exp">[</span><span class="symbol">k</span> <span class="symbol">v</span><span class="s-exp">]</span><span class="s-exp">]</span> <span class="s-exp">(</span><span class="symbol">core/list</span> <span class="reader-char">'</span><span class="special-form">set!</span> <span class="symbol">k</span> <span class="symbol">v</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">]</span>
    <span class="reader-char">`</span><span class="s-exp">(</span><span class="special-form">let</span> <span class="s-exp">[</span><span class="reader-char">~@</span><span class="s-exp">(</span><span class="core-fn">interleave</span> <span class="symbol">orig-val-syms</span> <span class="symbol">names</span><span class="s-exp">)</span>
           <span class="reader-char">~@</span><span class="s-exp">(</span><span class="core-fn">interleave</span> <span class="symbol">temp-val-syms</span> <span class="core-fn">vals</span><span class="s-exp">)</span><span class="s-exp">]</span>
       <span class="reader-char">~@</span><span class="s-exp">(</span><span class="core-fn">map</span> <span class="symbol">bind-value</span> <span class="symbol">binds</span><span class="s-exp">)</span>
       <span class="s-exp">(</span><span class="exception">try</span>
         <span class="reader-char">~@</span><span class="symbol">body</span>
         <span class="s-exp">(</span><span class="exception">finally</span>
           <span class="reader-char">~@</span><span class="s-exp">(</span><span class="core-fn">map</span> <span class="symbol">bind-value</span> <span class="symbol">resets</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span></code></pre><hr /></div><footer class="site-footer"><div class="wrapper"><hr /><div class="cljs-legal">ClojureScript is licensed <a href="http://opensource.org/licenses/eclipse-1.0.php">EPL 1.0</a><br />Copyright Â© Rich Hickey</div></div></footer></div><script src="/js/client.js"></script></body></html>