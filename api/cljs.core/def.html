<html><head><meta charset="utf-8" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><meta content="width=device-width, initial-scale=1" name="viewport" /><title>def</title><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700" rel="stylesheet" /><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet" /><link href="/css/normalize.css" rel="stylesheet" /><link href="/css/skeleton.css" rel="stylesheet" /><link href="/css/custom.css" rel="stylesheet" /><link href="/css/github-theme.css" rel="stylesheet" /><link href="/img/icons/apple-touch-icon-57x57.png" rel="apple-touch-icon" sizes="57x57" /><link href="/img/icons/apple-touch-icon-114x114.png" rel="apple-touch-icon" sizes="114x114" /><link href="/img/icons/apple-touch-icon-72x72.png" rel="apple-touch-icon" sizes="72x72" /><link href="/img/icons/apple-touch-icon-144x144.png" rel="apple-touch-icon" sizes="144x144" /><link href="/img/icons/apple-touch-icon-60x60.png" rel="apple-touch-icon" sizes="60x60" /><link href="/img/icons/apple-touch-icon-120x120.png" rel="apple-touch-icon" sizes="120x120" /><link href="/img/icons/apple-touch-icon-76x76.png" rel="apple-touch-icon" sizes="76x76" /><link href="/img/icons/apple-touch-icon-152x152.png" rel="apple-touch-icon" sizes="152x152" /><link href="/img/icons/apple-touch-icon-180x180.png" rel="apple-touch-icon" sizes="180x180" /><link href="/img/icons/favicon-192x192.png" rel="icon" sizes="192x192" type="image/png" /><link href="/img/icons/favicon-160x160.png" rel="icon" sizes="160x160" type="image/png" /><link href="/img/icons/favicon-96x96.png" rel="icon" sizes="96x96" type="image/png" /><link href="/img/icons/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" /><link href="/img/icons/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" /></head><body><div class="container"><nav class="navbar"><div class="container"><ul class="navbar-list"><li class="navbar-item"><a class="navbar-link-logo"><img class="navbar-logo" src="/img/cljs-white.svg" /></a></li><li class="navbar-item"><a class="navbar-title">ClojureScript</a></li><li class="navbar-item"><a class="navbar-link" href="/api">API</a></li><li class="navbar-item"><a class="navbar-link" href="https://github.com/clojure/clojurescript" target="_blank">GitHub</a></li></ul></div></nav><div><h1 class="g">def</h1><em>known as "define"</em><table><tr><td>special form</td><td>since v0.0-927</td><td><a href="http://clojure.github.io/clojure/branch-master/clojure.core-api.html#clojure.core/def"><img height="24px" src="/img/clojure-icon.gif" valign="middle" /> clojure.core/def</a></td><td><a href="https://github.com/cljs/api/blob/master/docfiles/cljs.core/def.md">Edit</a></td></tr></table><div><code>(def symbol doc-string? init?)</code></div><hr /><h3>Details:</h3><div><p>Creates a global variable with the name of <code class="syntax"><span class="core-fn">symbol</span></code> and a namespace of the
current namespace.</p>
<p>If <code class="syntax"><span class="symbol">init</span></code> is supplied, it is evaluated and the result is assigned to <code class="syntax"><span class="core-fn">symbol</span></code>.</p>
<p><code class="syntax"><span class="symbol">doc-string</span></code> is an optional documentation string.</p>
<p><code class="syntax"><span class="special-form">def</span></code> is one of ClojureScript's <a href="http://clojure.org/special_forms">special forms</a>
and is used by many macros to define common elements (ie: <code class="syntax"><span class="definition">defn</span></code>, <code class="syntax"><span class="definition">defmacro</span></code>,
etc).</p>
<p>Supported metadata:</p>
<ul>
<li><code class="syntax"><span class="reader-char">^</span><span class="s-exp">{</span><span class="keyword">:private</span> <span class="core-fn">boolean</span><span class="s-exp">}</span></code> - make non-accessible from other namespaces</li>
<li><code class="syntax"><span class="reader-char">^</span><span class="s-exp">{</span><span class="keyword">:dynamic</span> <span class="core-fn">boolean</span><span class="s-exp">}</span></code> - make <a href="/api/cljs.core/binding">dynamically bindable</a> (usually named with <a href="/api/syntax/earmuffs"><code class="syntax"><span class="symbol">*earmuffs*</span></code></a>)</li>
<li><code class="syntax"><span class="reader-char">^</span><span class="s-exp">{</span><span class="keyword">:const</span> <span class="core-fn">boolean</span><span class="s-exp">}</span></code> - prevents redef and allows it to be used in <a href="/api/cljs.core/case"><code class="syntax"><span class="conditional">case</span></code></a>.</li>
<li><code class="syntax"><span class="reader-char">^</span><span class="s-exp">{</span><span class="keyword">:jsdoc</span> <span class="s-exp">[</span><span class="string">"..."</span><span class="s-exp">]</span><span class="s-exp">}</span></code> - vector of JSDoc Tags for <a href="https://developers.google.com/closure/compiler/docs/js-for-compiler?hl=en#tags">Google Closure</a> or <a href="http://usejsdoc.org/#block-tags">standard</a>.</li>
<li><code class="syntax"><span class="reader-char">^</span><span class="s-exp">{</span><span class="keyword">:test</span> <span class="s-exp">(</span><span class="special-form">fn</span> <span class="s-exp">[</span><span class="s-exp">]</span> <span class="s-exp">(</span><span class="macro">assert</span> <span class="symbol">...</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">}</span></code> - allows function to be tested with <a href="/api/cljs.core/test"><code class="syntax"><span class="core-fn">test</span></code></a>.</li>
<li><code class="syntax"><span class="reader-char">^</span><span class="s-exp">{</span><span class="keyword">:doc</span> <span class="string">"..."</span><span class="s-exp">}</span></code> - doc-string (prefer the use of the <code class="syntax"><span class="s-exp">(</span><span class="special-form">def</span> <span class="core-fn">symbol</span> <span class="symbol">doc-string</span> <span class="symbol">init</span><span class="s-exp">)</span></code>)</li>
<li><code class="syntax"><span class="reader-char">^</span><span class="s-exp">{</span><span class="keyword">:export</span> <span class="core-fn">boolean</span><span class="s-exp">}</span></code> - make this var publicly accessible from JS, using <code class="syntax"><span class="symbol">goog.exportSymbol</span></code></li>
</ul>
<p>Compiler will also add metadata:</p>
<ul>
<li><code class="syntax"><span class="keyword">:ns</span></code></li>
<li><code class="syntax"><span class="keyword">:name</span></code></li>
<li><code class="syntax"><span class="keyword">:file</span></code></li>
<li><code class="syntax"><span class="keyword">:line</span></code>, <code class="syntax"><span class="keyword">:end-line</span></code></li>
<li><code class="syntax"><span class="keyword">:column</span></code>, <code class="syntax"><span class="keyword">:end-column</span></code></li>
<li><code class="syntax"><span class="keyword">:source</span></code></li>
<li><code class="syntax"><span class="keyword">:arglists</span></code></li>
</ul>
</div><hr /><h3>Examples:</h3><div><pre><code class="syntax"><span class="s-exp">(</span><span class="special-form">def</span> <span class="symbol">a</span><span class="s-exp">)</span>
<span class="symbol">a</span>
<span class="comment">;;=> nil
</span>
<span class="s-exp">(</span><span class="special-form">def</span> <span class="symbol">b</span> <span class="number">42</span><span class="s-exp">)</span>
<span class="symbol">b</span>
<span class="comment">;;=> 42
</span>
<span class="s-exp">(</span><span class="special-form">def</span> <span class="symbol">c</span> <span class="string">"an optional docstring"</span> <span class="number">42</span><span class="s-exp">)</span>
<span class="symbol">c</span>
<span class="comment">;;=> 42
</span></code></pre>
</div><hr /><h3>See Also:</h3><ul><li><a href="/api/cljs.core/defn">defn</a></li><li><a href="/api/cljs.core/fn">fn</a></li><li><a href="/api/cljs.core/defmacro">defmacro</a></li><li><a href="/api/cljs.core/defmulti">defmulti</a></li></ul><hr />Source docstring:<pre>Creates and interns a global var with the name
of symbol in the current namespace (*ns*) or locates such a var if
it already exists.  If init is supplied, it is evaluated, and the
root binding of the var is set to the resulting value.  If init is
not supplied, the root binding of the var is unaffected.</pre><div>Parser code @ <a href="https://github.com/clojure/clojurescript/blob/r1.11.51/src/main/clojure/cljs/analyzer.cljc#L1931-L2115">clojurescript:src/main/clojure/cljs/analyzer.cljc</a></div><pre><code class="syntax"><span class="s-exp">(</span><span class="definition">defmethod</span> <span class="symbol">parse</span> <span class="reader-char">'</span><span class="special-form">def</span>
  <span class="s-exp">[</span><span class="symbol">op</span> <span class="symbol">env</span> <span class="symbol">form</span> <span class="symbol">_</span> <span class="symbol">_</span><span class="s-exp">]</span>
  <span class="s-exp">(</span><span class="conditional">when</span> <span class="s-exp">(</span><span class="core-fn">></span> <span class="s-exp">(</span><span class="core-fn">count</span> <span class="symbol">form</span><span class="s-exp">)</span> <span class="number">4</span><span class="s-exp">)</span>
    <span class="s-exp">(</span><span class="exception">throw</span> <span class="s-exp">(</span><span class="symbol">error</span> <span class="symbol">env</span> <span class="string">"Too many arguments to def"</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
  <span class="s-exp">(</span><span class="special-form">let</span> <span class="s-exp">[</span><span class="symbol">pfn</span> <span class="s-exp">(</span><span class="special-form">fn</span>
              <span class="s-exp">(</span><span class="s-exp">[</span><span class="symbol">_</span> <span class="symbol">sym</span><span class="s-exp">]</span> <span class="s-exp">{</span><span class="keyword">:sym</span> <span class="symbol">sym</span><span class="s-exp">}</span><span class="s-exp">)</span>
              <span class="s-exp">(</span><span class="s-exp">[</span><span class="symbol">_</span> <span class="symbol">sym</span> <span class="symbol">init</span><span class="s-exp">]</span> <span class="s-exp">{</span><span class="keyword">:sym</span> <span class="symbol">sym</span> <span class="keyword">:init</span> <span class="symbol">init</span><span class="s-exp">}</span><span class="s-exp">)</span>
              <span class="s-exp">(</span><span class="s-exp">[</span><span class="symbol">_</span> <span class="symbol">sym</span> <span class="symbol">doc</span> <span class="symbol">init</span><span class="s-exp">]</span> <span class="s-exp">{</span><span class="keyword">:sym</span> <span class="symbol">sym</span> <span class="keyword">:doc</span> <span class="symbol">doc</span> <span class="keyword">:init</span> <span class="symbol">init</span><span class="s-exp">}</span><span class="s-exp">)</span><span class="s-exp">)</span>
        <span class="symbol">args</span> <span class="s-exp">(</span><span class="core-fn">apply</span> <span class="symbol">pfn</span> <span class="symbol">form</span><span class="s-exp">)</span>
        <span class="symbol">sym</span> <span class="s-exp">(</span><span class="keyword">:sym</span> <span class="symbol">args</span><span class="s-exp">)</span>
        <span class="symbol">const?</span> <span class="s-exp">(</span><span class="macro">-></span> <span class="symbol">sym</span> <span class="core-fn">meta</span> <span class="keyword">:const</span><span class="s-exp">)</span>
        <span class="symbol">sym-meta</span> <span class="s-exp">(</span><span class="core-fn">meta</span> <span class="symbol">sym</span><span class="s-exp">)</span>
        <span class="symbol">tag</span> <span class="s-exp">(</span><span class="macro">-></span> <span class="symbol">sym</span> <span class="core-fn">meta</span> <span class="keyword">:tag</span><span class="s-exp">)</span>
        <span class="symbol">protocol</span> <span class="s-exp">(</span><span class="macro">-></span> <span class="symbol">sym</span> <span class="core-fn">meta</span> <span class="keyword">:protocol</span> <span class="symbol">valid-proto</span><span class="s-exp">)</span>
        <span class="symbol">dynamic</span> <span class="s-exp">(</span><span class="macro">-></span> <span class="symbol">sym</span> <span class="core-fn">meta</span> <span class="keyword">:dynamic</span><span class="s-exp">)</span>
        <span class="core-fn">ns-name</span> <span class="s-exp">(</span><span class="macro">-></span> <span class="symbol">env</span> <span class="keyword">:ns</span> <span class="keyword">:name</span><span class="s-exp">)</span>
        <span class="symbol">locals</span> <span class="s-exp">(</span><span class="keyword">:locals</span> <span class="symbol">env</span><span class="s-exp">)</span>
        <span class="symbol">clash-ns</span> <span class="s-exp">(</span><span class="core-fn">symbol</span> <span class="s-exp">(</span><span class="core-fn">str</span> <span class="core-fn">ns-name</span> <span class="string">"."</span> <span class="symbol">sym</span><span class="s-exp">)</span><span class="s-exp">)</span>
        <span class="symbol">sym-ns</span>   <span class="s-exp">(</span><span class="core-fn">namespace</span> <span class="symbol">sym</span><span class="s-exp">)</span>
        <span class="symbol">sym</span>      <span class="s-exp">(</span><span class="conditional">cond</span>
                   <span class="s-exp">(</span><span class="macro">and</span> <span class="symbol">sym-ns</span> <span class="s-exp">(</span><span class="core-fn">not</span> <span class="reader-char">#</span><span class="symbol">?</span><span class="s-exp">(</span><span class="keyword">:clj</span>  <span class="s-exp">(</span><span class="core-fn">=</span> <span class="s-exp">(</span><span class="core-fn">symbol</span> <span class="symbol">sym-ns</span><span class="s-exp">)</span> <span class="core-fn">ns-name</span><span class="s-exp">)</span>
                                       <span class="keyword">:cljs</span> <span class="s-exp">(</span><span class="symbol">symbol-identical?</span> <span class="s-exp">(</span><span class="core-fn">symbol</span> <span class="symbol">sym-ns</span><span class="s-exp">)</span> <span class="core-fn">ns-name</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
                   <span class="s-exp">(</span><span class="exception">throw</span> <span class="s-exp">(</span><span class="symbol">error</span> <span class="symbol">env</span> <span class="s-exp">(</span><span class="core-fn">str</span> <span class="string">"Can't def ns-qualified name in namespace "</span> <span class="symbol">sym-ns</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>

                   <span class="s-exp">(</span><span class="core-fn">some?</span> <span class="symbol">sym-ns</span><span class="s-exp">)</span>
                   <span class="s-exp">(</span><span class="core-fn">symbol</span> <span class="s-exp">(</span><span class="core-fn">name</span> <span class="symbol">sym</span><span class="s-exp">)</span><span class="s-exp">)</span>

                   <span class="keyword">:else</span> <span class="symbol">sym</span><span class="s-exp">)</span><span class="s-exp">]</span>
    <span class="s-exp">(</span><span class="conditional">when</span> <span class="s-exp">(</span><span class="core-fn">some?</span> <span class="s-exp">(</span><span class="core-fn">get-in</span> <span class="reader-char">@</span><span class="symbol">env/*compiler*</span> <span class="s-exp">[</span><span class="keyword">::namespaces</span> <span class="symbol">clash-ns</span><span class="s-exp">]</span><span class="s-exp">)</span><span class="s-exp">)</span>
      <span class="s-exp">(</span><span class="symbol">warning</span> <span class="keyword">:ns-var-clash</span> <span class="symbol">env</span>
        <span class="s-exp">{</span><span class="keyword">:ns</span> <span class="s-exp">(</span><span class="core-fn">symbol</span> <span class="s-exp">(</span><span class="core-fn">str</span> <span class="core-fn">ns-name</span> <span class="string">"."</span> <span class="symbol">sym</span><span class="s-exp">)</span><span class="s-exp">)</span>
         <span class="keyword">:var</span> <span class="s-exp">(</span><span class="core-fn">symbol</span> <span class="s-exp">(</span><span class="core-fn">str</span> <span class="core-fn">ns-name</span><span class="s-exp">)</span> <span class="s-exp">(</span><span class="core-fn">str</span> <span class="symbol">sym</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">}</span><span class="s-exp">)</span><span class="s-exp">)</span>
    <span class="s-exp">(</span><span class="conditional">when</span> <span class="s-exp">(</span><span class="core-fn">some?</span> <span class="s-exp">(</span><span class="keyword">:const</span> <span class="s-exp">(</span><span class="symbol">resolve-var</span> <span class="s-exp">(</span><span class="core-fn">dissoc</span> <span class="symbol">env</span> <span class="keyword">:locals</span><span class="s-exp">)</span> <span class="symbol">sym</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
      <span class="s-exp">(</span><span class="exception">throw</span> <span class="s-exp">(</span><span class="symbol">error</span> <span class="symbol">env</span> <span class="string">"Can't redefine a constant"</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
    <span class="s-exp">(</span><span class="conditional">when-some</span> <span class="s-exp">[</span><span class="symbol">doc</span> <span class="s-exp">(</span><span class="keyword">:doc</span> <span class="symbol">args</span><span class="s-exp">)</span><span class="s-exp">]</span>
      <span class="s-exp">(</span><span class="conditional">when-not</span> <span class="s-exp">(</span><span class="core-fn">string?</span> <span class="symbol">doc</span><span class="s-exp">)</span>
        <span class="s-exp">(</span><span class="exception">throw</span> <span class="s-exp">(</span><span class="symbol">error</span> <span class="symbol">env</span> <span class="string">"Too many arguments to def"</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
    <span class="s-exp">(</span><span class="conditional">when</span> <span class="s-exp">(</span><span class="macro">and</span> <span class="s-exp">(</span><span class="core-fn">not</span> <span class="symbol">dynamic</span><span class="s-exp">)</span>
               <span class="s-exp">(</span><span class="symbol">earmuffed?</span> <span class="symbol">sym</span><span class="s-exp">)</span>
               <span class="s-exp">(</span><span class="core-fn">not</span> <span class="s-exp">(</span><span class="symbol">core-ns?</span> <span class="core-fn">ns-name</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
      <span class="s-exp">(</span><span class="symbol">warning</span> <span class="keyword">:non-dynamic-earmuffed-var</span> <span class="symbol">env</span>
        <span class="s-exp">{</span><span class="keyword">:var</span> <span class="s-exp">(</span><span class="core-fn">str</span> <span class="symbol">sym</span><span class="s-exp">)</span><span class="s-exp">}</span><span class="s-exp">)</span><span class="s-exp">)</span>
    <span class="s-exp">(</span><span class="conditional">when-some</span> <span class="s-exp">[</span><span class="symbol">v</span> <span class="s-exp">(</span><span class="core-fn">get-in</span> <span class="reader-char">@</span><span class="symbol">env/*compiler*</span> <span class="s-exp">[</span><span class="keyword">::namespaces</span> <span class="core-fn">ns-name</span> <span class="keyword">:defs</span> <span class="symbol">sym</span><span class="s-exp">]</span><span class="s-exp">)</span><span class="s-exp">]</span>
      <span class="s-exp">(</span><span class="conditional">when</span> <span class="s-exp">(</span><span class="macro">and</span> <span class="s-exp">(</span><span class="core-fn">not</span> <span class="symbol">*allow-redef*</span><span class="s-exp">)</span>
                 <span class="s-exp">(</span><span class="core-fn">not</span> <span class="s-exp">(</span><span class="keyword">:declared</span> <span class="symbol">v</span><span class="s-exp">)</span><span class="s-exp">)</span>
                 <span class="s-exp">(</span><span class="core-fn">not</span> <span class="s-exp">(</span><span class="keyword">:declared</span> <span class="symbol">sym-meta</span><span class="s-exp">)</span><span class="s-exp">)</span>
                 <span class="symbol">*file-defs*</span>
                 <span class="s-exp">(</span><span class="core-fn">get</span> <span class="reader-char">@</span><span class="symbol">*file-defs*</span> <span class="symbol">sym</span><span class="s-exp">)</span><span class="s-exp">)</span>
        <span class="s-exp">(</span><span class="symbol">warning</span> <span class="keyword">:redef-in-file</span> <span class="symbol">env</span> <span class="s-exp">{</span><span class="keyword">:sym</span> <span class="symbol">sym</span> <span class="keyword">:line</span> <span class="s-exp">(</span><span class="keyword">:line</span> <span class="symbol">v</span><span class="s-exp">)</span><span class="s-exp">}</span><span class="s-exp">)</span><span class="s-exp">)</span>
      <span class="s-exp">(</span><span class="conditional">when</span> <span class="s-exp">(</span><span class="macro">and</span> <span class="s-exp">(</span><span class="keyword">:declared</span> <span class="symbol">v</span><span class="s-exp">)</span>
                 <span class="s-exp">(</span><span class="keyword">:arglists</span> <span class="symbol">v</span><span class="s-exp">)</span>
                 <span class="s-exp">(</span><span class="core-fn">not=</span> <span class="s-exp">(</span><span class="keyword">:arglists</span> <span class="symbol">v</span><span class="s-exp">)</span> <span class="s-exp">(</span><span class="keyword">:arglists</span> <span class="symbol">sym-meta</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
        <span class="s-exp">(</span><span class="symbol">warning</span> <span class="keyword">:declared-arglists-mismatch</span> <span class="symbol">env</span> <span class="s-exp">{</span><span class="keyword">:ns-name</span>  <span class="core-fn">ns-name</span> <span class="keyword">:sym</span> <span class="symbol">sym</span>
                                                  <span class="keyword">:declared</span> <span class="s-exp">(</span><span class="core-fn">second</span> <span class="s-exp">(</span><span class="keyword">:arglists</span> <span class="symbol">v</span><span class="s-exp">)</span><span class="s-exp">)</span>
                                                  <span class="keyword">:defined</span>  <span class="s-exp">(</span><span class="core-fn">second</span> <span class="s-exp">(</span><span class="keyword">:arglists</span> <span class="symbol">sym-meta</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">}</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
    <span class="s-exp">(</span><span class="special-form">let</span> <span class="s-exp">[</span><span class="symbol">env</span> <span class="s-exp">(</span><span class="special-form">if</span> <span class="s-exp">(</span><span class="macro">or</span> <span class="s-exp">(</span><span class="macro">and</span> <span class="s-exp">(</span><span class="core-fn">not=</span> <span class="core-fn">ns-name</span> <span class="reader-char">'</span><span class="symbol">cljs.core</span><span class="s-exp">)</span>
                           <span class="s-exp">(</span><span class="symbol">core-name?</span> <span class="symbol">env</span> <span class="symbol">sym</span><span class="s-exp">)</span><span class="s-exp">)</span>
                      <span class="s-exp">(</span><span class="core-fn">some?</span> <span class="s-exp">(</span><span class="core-fn">get-in</span> <span class="reader-char">@</span><span class="symbol">env/*compiler*</span> <span class="s-exp">[</span><span class="keyword">::namespaces</span> <span class="core-fn">ns-name</span> <span class="keyword">:uses</span> <span class="symbol">sym</span><span class="s-exp">]</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
                <span class="s-exp">(</span><span class="special-form">let</span> <span class="s-exp">[</span><span class="symbol">ev</span> <span class="s-exp">(</span><span class="symbol">resolve-existing-var</span> <span class="s-exp">(</span><span class="core-fn">dissoc</span> <span class="symbol">env</span> <span class="keyword">:locals</span><span class="s-exp">)</span>
                           <span class="comment">;; ::no-resolve true is to suppress "can't take value
</span>                           <span class="comment">;; of macro warning" when sym resolves to a macro
</span>                           <span class="s-exp">(</span><span class="core-fn">with-meta</span> <span class="symbol">sym</span> <span class="s-exp">{</span><span class="keyword">::no-resolve</span> <span class="boolean">true</span><span class="s-exp">}</span><span class="s-exp">)</span><span class="s-exp">)</span>
                      <span class="symbol">conj-to-set</span> <span class="s-exp">(</span><span class="core-fn">fnil</span> <span class="core-fn">conj</span> <span class="s-exp">#{</span><span class="s-exp">}</span><span class="s-exp">)</span><span class="s-exp">]</span>
                  <span class="s-exp">(</span><span class="conditional">when</span> <span class="s-exp">(</span><span class="symbol">public-name?</span> <span class="s-exp">(</span><span class="keyword">:ns</span> <span class="symbol">ev</span><span class="s-exp">)</span> <span class="symbol">sym</span><span class="s-exp">)</span>
                    <span class="s-exp">(</span><span class="symbol">warning</span> <span class="keyword">:redef</span> <span class="symbol">env</span> <span class="s-exp">{</span><span class="keyword">:sym</span> <span class="symbol">sym</span> <span class="keyword">:ns</span> <span class="s-exp">(</span><span class="keyword">:ns</span> <span class="symbol">ev</span><span class="s-exp">)</span> <span class="keyword">:ns-name</span> <span class="core-fn">ns-name</span><span class="s-exp">}</span><span class="s-exp">)</span><span class="s-exp">)</span>
                  <span class="s-exp">(</span><span class="core-fn">swap!</span> <span class="symbol">env/*compiler*</span> <span class="core-fn">update-in</span> <span class="s-exp">[</span><span class="keyword">::namespaces</span> <span class="core-fn">ns-name</span> <span class="keyword">:excludes</span><span class="s-exp">]</span>
                     <span class="symbol">conj-to-set</span> <span class="symbol">sym</span><span class="s-exp">)</span>
                  <span class="s-exp">(</span><span class="core-fn">update-in</span> <span class="symbol">env</span> <span class="s-exp">[</span><span class="keyword">:ns</span> <span class="keyword">:excludes</span><span class="s-exp">]</span> <span class="symbol">conj-to-set</span> <span class="symbol">sym</span><span class="s-exp">)</span><span class="s-exp">)</span>
                <span class="symbol">env</span><span class="s-exp">)</span>
          <span class="symbol">var-name</span> <span class="s-exp">(</span><span class="keyword">:name</span> <span class="s-exp">(</span><span class="symbol">resolve-var</span> <span class="s-exp">(</span><span class="core-fn">dissoc</span> <span class="symbol">env</span> <span class="keyword">:locals</span><span class="s-exp">)</span> <span class="symbol">sym</span><span class="s-exp">)</span><span class="s-exp">)</span>
          <span class="symbol">init-expr</span> <span class="s-exp">(</span><span class="conditional">when</span> <span class="s-exp">(</span><span class="core-fn">contains?</span> <span class="symbol">args</span> <span class="keyword">:init</span><span class="s-exp">)</span>
                      <span class="s-exp">(</span><span class="core-fn">swap!</span> <span class="symbol">env/*compiler*</span> <span class="core-fn">assoc-in</span> <span class="s-exp">[</span><span class="keyword">::namespaces</span> <span class="core-fn">ns-name</span> <span class="keyword">:defs</span> <span class="symbol">sym</span><span class="s-exp">]</span>
                        <span class="s-exp">(</span><span class="core-fn">merge</span>
                          <span class="s-exp">{</span><span class="keyword">:name</span> <span class="symbol">var-name</span><span class="s-exp">}</span>
                          <span class="symbol">sym-meta</span>
                          <span class="s-exp">(</span><span class="conditional">when</span> <span class="s-exp">(</span><span class="core-fn">true?</span> <span class="symbol">dynamic</span><span class="s-exp">)</span> <span class="s-exp">{</span><span class="keyword">:dynamic</span> <span class="boolean">true</span><span class="s-exp">}</span><span class="s-exp">)</span>
                          <span class="s-exp">(</span><span class="symbol">source-info</span> <span class="symbol">var-name</span> <span class="symbol">env</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
                      <span class="s-exp">(</span><span class="symbol">disallowing-recur</span>
                        <span class="s-exp">(</span><span class="symbol">disallowing-ns*</span>
                          <span class="s-exp">(</span><span class="symbol">analyze</span> <span class="s-exp">(</span><span class="core-fn">assoc</span> <span class="symbol">env</span> <span class="keyword">:context</span> <span class="keyword">:expr</span><span class="s-exp">)</span> <span class="s-exp">(</span><span class="keyword">:init</span> <span class="symbol">args</span><span class="s-exp">)</span> <span class="symbol">sym</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
          <span class="symbol">fn-var?</span> <span class="s-exp">(</span><span class="macro">and</span> <span class="s-exp">(</span><span class="core-fn">some?</span> <span class="symbol">init-expr</span><span class="s-exp">)</span> <span class="s-exp">(</span><span class="core-fn">=</span> <span class="s-exp">(</span><span class="keyword">:op</span> <span class="symbol">init-expr</span><span class="s-exp">)</span> <span class="keyword">:fn</span><span class="s-exp">)</span><span class="s-exp">)</span>
          <span class="symbol">tag</span> <span class="s-exp">(</span><span class="conditional">cond</span>
                <span class="symbol">fn-var?</span> <span class="s-exp">(</span><span class="macro">or</span> <span class="s-exp">(</span><span class="keyword">:ret-tag</span> <span class="symbol">init-expr</span><span class="s-exp">)</span> <span class="symbol">tag</span> <span class="s-exp">(</span><span class="keyword">:inferred-ret-tag</span> <span class="symbol">init-expr</span><span class="s-exp">)</span><span class="s-exp">)</span>
                <span class="symbol">tag</span> <span class="symbol">tag</span>
                <span class="symbol">dynamic</span> <span class="symbol">impl/ANY_SYM</span>
                <span class="keyword">:else</span> <span class="s-exp">(</span><span class="keyword">:tag</span> <span class="symbol">init-expr</span><span class="s-exp">)</span><span class="s-exp">)</span>
          <span class="symbol">export-as</span> <span class="s-exp">(</span><span class="conditional">when-let</span> <span class="s-exp">[</span><span class="symbol">export-val</span> <span class="s-exp">(</span><span class="macro">-></span> <span class="symbol">sym</span> <span class="core-fn">meta</span> <span class="keyword">:export</span><span class="s-exp">)</span><span class="s-exp">]</span>
                      <span class="s-exp">(</span><span class="special-form">if</span> <span class="s-exp">(</span><span class="core-fn">=</span> <span class="boolean">true</span> <span class="symbol">export-val</span><span class="s-exp">)</span> <span class="symbol">var-name</span> <span class="symbol">export-val</span><span class="s-exp">)</span><span class="s-exp">)</span>
          <span class="symbol">doc</span> <span class="s-exp">(</span><span class="macro">or</span> <span class="s-exp">(</span><span class="keyword">:doc</span> <span class="symbol">args</span><span class="s-exp">)</span> <span class="s-exp">(</span><span class="macro">-></span> <span class="symbol">sym</span> <span class="core-fn">meta</span> <span class="keyword">:doc</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">]</span>
      <span class="s-exp">(</span><span class="conditional">when-some</span> <span class="s-exp">[</span><span class="symbol">v</span> <span class="s-exp">(</span><span class="core-fn">get-in</span> <span class="reader-char">@</span><span class="symbol">env/*compiler*</span> <span class="s-exp">[</span><span class="keyword">::namespaces</span> <span class="core-fn">ns-name</span> <span class="keyword">:defs</span> <span class="symbol">sym</span><span class="s-exp">]</span><span class="s-exp">)</span><span class="s-exp">]</span>
        <span class="s-exp">(</span><span class="conditional">when</span> <span class="s-exp">(</span><span class="macro">and</span> <span class="s-exp">(</span><span class="core-fn">not</span> <span class="s-exp">(</span><span class="macro">-></span> <span class="symbol">sym</span> <span class="core-fn">meta</span> <span class="keyword">:declared</span><span class="s-exp">)</span><span class="s-exp">)</span>
                   <span class="s-exp">(</span><span class="macro">and</span> <span class="s-exp">(</span><span class="core-fn">true?</span> <span class="s-exp">(</span><span class="keyword">:fn-var</span> <span class="symbol">v</span><span class="s-exp">)</span><span class="s-exp">)</span> <span class="s-exp">(</span><span class="core-fn">not</span> <span class="symbol">fn-var?</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
          <span class="s-exp">(</span><span class="symbol">warning</span> <span class="keyword">:fn-var</span> <span class="symbol">env</span> <span class="s-exp">{</span><span class="keyword">:ns-name</span> <span class="core-fn">ns-name</span> <span class="keyword">:sym</span> <span class="symbol">sym</span><span class="s-exp">}</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>

      <span class="comment">;; declare must not replace any analyzer data of an already def'd sym
</span>      <span class="s-exp">(</span><span class="conditional">when</span> <span class="s-exp">(</span><span class="macro">or</span> <span class="s-exp">(</span><span class="core-fn">nil?</span> <span class="s-exp">(</span><span class="core-fn">get-in</span> <span class="reader-char">@</span><span class="symbol">env/*compiler*</span> <span class="s-exp">[</span><span class="keyword">::namespaces</span> <span class="core-fn">ns-name</span> <span class="keyword">:defs</span> <span class="symbol">sym</span><span class="s-exp">]</span><span class="s-exp">)</span><span class="s-exp">)</span>
                <span class="s-exp">(</span><span class="core-fn">not</span> <span class="s-exp">(</span><span class="keyword">:declared</span> <span class="symbol">sym-meta</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
        <span class="s-exp">(</span><span class="conditional">when</span> <span class="symbol">*file-defs*</span>
          <span class="s-exp">(</span><span class="core-fn">swap!</span> <span class="symbol">*file-defs*</span> <span class="core-fn">conj</span> <span class="symbol">sym</span><span class="s-exp">)</span><span class="s-exp">)</span>

        <span class="s-exp">(</span><span class="core-fn">swap!</span> <span class="symbol">env/*compiler*</span> <span class="core-fn">assoc-in</span> <span class="s-exp">[</span><span class="keyword">::namespaces</span> <span class="core-fn">ns-name</span> <span class="keyword">:defs</span> <span class="symbol">sym</span><span class="s-exp">]</span>
          <span class="s-exp">(</span><span class="core-fn">merge</span>
            <span class="s-exp">{</span><span class="keyword">:name</span> <span class="symbol">var-name</span><span class="s-exp">}</span>
            <span class="comment">;; remove actual test metadata, as it includes non-valid EDN and
</span>            <span class="comment">;; cannot be present in analysis cached to disk - David
</span>            <span class="s-exp">(</span><span class="conditional">cond-></span> <span class="symbol">sym-meta</span>
              <span class="s-exp">(</span><span class="keyword">:test</span> <span class="symbol">sym-meta</span><span class="s-exp">)</span> <span class="s-exp">(</span><span class="core-fn">assoc</span> <span class="keyword">:test</span> <span class="boolean">true</span><span class="s-exp">)</span><span class="s-exp">)</span>
            <span class="s-exp">{</span><span class="keyword">:meta</span> <span class="s-exp">(</span><span class="macro">-></span> <span class="symbol">sym-meta</span>
                       <span class="s-exp">(</span><span class="core-fn">dissoc</span> <span class="keyword">:test</span><span class="s-exp">)</span>
                       <span class="s-exp">(</span><span class="core-fn">update-in</span> <span class="s-exp">[</span><span class="keyword">:file</span><span class="s-exp">]</span>
                         <span class="s-exp">(</span><span class="special-form">fn</span> <span class="s-exp">[</span><span class="symbol">f</span><span class="s-exp">]</span>
                           <span class="s-exp">(</span><span class="special-form">if</span> <span class="s-exp">(</span><span class="core-fn">=</span> <span class="s-exp">(</span><span class="macro">-></span> <span class="symbol">env</span> <span class="keyword">:ns</span> <span class="keyword">:name</span><span class="s-exp">)</span> <span class="reader-char">'</span><span class="symbol">cljs.core</span><span class="s-exp">)</span>
                             <span class="string">"cljs/core.cljs"</span>
                             <span class="symbol">f</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">}</span>
            <span class="s-exp">(</span><span class="conditional">when</span> <span class="symbol">doc</span> <span class="s-exp">{</span><span class="keyword">:doc</span> <span class="symbol">doc</span><span class="s-exp">}</span><span class="s-exp">)</span>
            <span class="s-exp">(</span><span class="conditional">when</span> <span class="symbol">const?</span>
              <span class="s-exp">(</span><span class="special-form">let</span> <span class="s-exp">[</span><span class="symbol">const-expr</span>
                    <span class="s-exp">(</span><span class="macro">binding</span> <span class="s-exp">[</span><span class="symbol">*passes*</span> <span class="s-exp">(</span><span class="core-fn">conj</span> <span class="symbol">*passes*</span> <span class="s-exp">(</span><span class="symbol">replace-env-pass</span> <span class="s-exp">{</span><span class="keyword">:context</span> <span class="keyword">:expr</span><span class="s-exp">}</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">]</span>
                      <span class="s-exp">(</span><span class="symbol">analyze</span> <span class="symbol">env</span> <span class="s-exp">(</span><span class="keyword">:init</span> <span class="symbol">args</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">]</span>
                <span class="s-exp">(</span><span class="conditional">when</span> <span class="s-exp">(</span><span class="symbol">constant-value?</span> <span class="symbol">const-expr</span><span class="s-exp">)</span>
                  <span class="s-exp">{</span><span class="keyword">:const-expr</span> <span class="symbol">const-expr</span><span class="s-exp">}</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
            <span class="s-exp">(</span><span class="conditional">when</span> <span class="s-exp">(</span><span class="core-fn">true?</span> <span class="symbol">dynamic</span><span class="s-exp">)</span> <span class="s-exp">{</span><span class="keyword">:dynamic</span> <span class="boolean">true</span><span class="s-exp">}</span><span class="s-exp">)</span>
            <span class="s-exp">(</span><span class="symbol">source-info</span> <span class="symbol">var-name</span> <span class="symbol">env</span><span class="s-exp">)</span>
            <span class="comment">;; the protocol a protocol fn belongs to
</span>            <span class="s-exp">(</span><span class="conditional">when</span> <span class="symbol">protocol</span>
              <span class="s-exp">{</span><span class="keyword">:protocol</span> <span class="symbol">protocol</span><span class="s-exp">}</span><span class="s-exp">)</span>
            <span class="comment">;; symbol for reified protocol
</span>            <span class="s-exp">(</span><span class="conditional">when-let</span> <span class="s-exp">[</span><span class="symbol">protocol-symbol</span> <span class="s-exp">(</span><span class="macro">-></span> <span class="symbol">sym</span> <span class="core-fn">meta</span> <span class="keyword">:protocol-symbol</span><span class="s-exp">)</span><span class="s-exp">]</span>
              <span class="s-exp">{</span><span class="keyword">:protocol-symbol</span> <span class="symbol">protocol-symbol</span>
               <span class="keyword">:info</span> <span class="s-exp">(</span><span class="macro">-></span> <span class="symbol">protocol-symbol</span> <span class="core-fn">meta</span> <span class="keyword">:protocol-info</span><span class="s-exp">)</span>
               <span class="keyword">:impls</span> <span class="s-exp">#{</span><span class="s-exp">}</span><span class="s-exp">}</span><span class="s-exp">)</span>
            <span class="s-exp">(</span><span class="conditional">when</span> <span class="symbol">fn-var?</span>
              <span class="s-exp">(</span><span class="special-form">let</span> <span class="s-exp">[</span><span class="symbol">params</span> <span class="s-exp">(</span><span class="core-fn">map</span> <span class="reader-char">#</span><span class="s-exp">(</span><span class="core-fn">vec</span> <span class="s-exp">(</span><span class="core-fn">map</span> <span class="keyword">:name</span> <span class="s-exp">(</span><span class="keyword">:params</span> <span class="keyword">%</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span> <span class="s-exp">(</span><span class="keyword">:methods</span> <span class="symbol">init-expr</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">]</span>
                <span class="s-exp">(</span><span class="core-fn">merge</span>
                  <span class="s-exp">{</span><span class="keyword">:fn-var</span> <span class="s-exp">(</span><span class="core-fn">not</span> <span class="s-exp">(</span><span class="keyword">:macro</span> <span class="symbol">sym-meta</span><span class="s-exp">)</span><span class="s-exp">)</span>
                   <span class="comment">;; protocol implementation context
</span>                   <span class="keyword">:protocol-impl</span> <span class="s-exp">(</span><span class="keyword">:protocol-impl</span> <span class="symbol">init-expr</span><span class="s-exp">)</span>
                   <span class="comment">;; inline protocol implementation context
</span>                   <span class="keyword">:protocol-inline</span> <span class="s-exp">(</span><span class="keyword">:protocol-inline</span> <span class="symbol">init-expr</span><span class="s-exp">)</span><span class="s-exp">}</span>
                  <span class="s-exp">(</span><span class="conditional">if-some</span> <span class="s-exp">[</span><span class="symbol">top-fn-meta</span> <span class="s-exp">(</span><span class="keyword">:top-fn</span> <span class="symbol">sym-meta</span><span class="s-exp">)</span><span class="s-exp">]</span>
                    <span class="symbol">top-fn-meta</span>
                    <span class="s-exp">{</span><span class="keyword">:variadic?</span> <span class="s-exp">(</span><span class="keyword">:variadic?</span> <span class="symbol">init-expr</span><span class="s-exp">)</span>
                     <span class="keyword">:max-fixed-arity</span> <span class="s-exp">(</span><span class="keyword">:max-fixed-arity</span> <span class="symbol">init-expr</span><span class="s-exp">)</span>
                     <span class="keyword">:method-params</span> <span class="symbol">params</span>
                     <span class="keyword">:arglists</span> <span class="s-exp">(</span><span class="keyword">:arglists</span> <span class="symbol">sym-meta</span><span class="s-exp">)</span>
                     <span class="keyword">:arglists-meta</span> <span class="s-exp">(</span><span class="core-fn">doall</span> <span class="s-exp">(</span><span class="core-fn">map</span> <span class="core-fn">meta</span> <span class="s-exp">(</span><span class="keyword">:arglists</span> <span class="symbol">sym-meta</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">}</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
            <span class="s-exp">(</span><span class="conditional">when</span> <span class="s-exp">(</span><span class="macro">and</span> <span class="s-exp">(</span><span class="keyword">:declared</span> <span class="symbol">sym-meta</span><span class="s-exp">)</span>
                       <span class="s-exp">(</span><span class="keyword">:arglists</span> <span class="symbol">sym-meta</span><span class="s-exp">)</span><span class="s-exp">)</span>
              <span class="s-exp">{</span><span class="keyword">:declared</span> <span class="boolean">true</span>
               <span class="keyword">:fn-var</span> <span class="boolean">true</span>
               <span class="keyword">:method-params</span> <span class="s-exp">(</span><span class="core-fn">second</span> <span class="s-exp">(</span><span class="keyword">:arglists</span> <span class="symbol">sym-meta</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">}</span><span class="s-exp">)</span>
            <span class="s-exp">(</span><span class="special-form">if</span> <span class="s-exp">(</span><span class="macro">and</span> <span class="symbol">fn-var?</span> <span class="s-exp">(</span><span class="core-fn">some?</span> <span class="symbol">tag</span><span class="s-exp">)</span><span class="s-exp">)</span>
              <span class="s-exp">{</span><span class="keyword">:ret-tag</span> <span class="symbol">tag</span><span class="s-exp">}</span>
              <span class="s-exp">(</span><span class="conditional">when</span> <span class="symbol">tag</span> <span class="s-exp">{</span><span class="keyword">:tag</span> <span class="symbol">tag</span><span class="s-exp">}</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
      <span class="s-exp">(</span><span class="core-fn">merge</span>
        <span class="s-exp">{</span><span class="keyword">:env</span> <span class="symbol">env</span>
         <span class="keyword">:op</span> <span class="keyword">:def</span>
         <span class="keyword">:form</span> <span class="symbol">form</span>
         <span class="keyword">:ns</span> <span class="core-fn">ns-name</span>
         <span class="keyword">:name</span> <span class="symbol">var-name</span>
         <span class="keyword">:var</span> <span class="s-exp">(</span><span class="core-fn">assoc</span>
                <span class="s-exp">(</span><span class="symbol">analyze</span>
                  <span class="s-exp">(</span><span class="macro">-></span> <span class="symbol">env</span> <span class="s-exp">(</span><span class="core-fn">dissoc</span> <span class="keyword">:locals</span><span class="s-exp">)</span>
                    <span class="s-exp">(</span><span class="core-fn">assoc</span> <span class="keyword">:context</span> <span class="keyword">:expr</span><span class="s-exp">)</span>
                    <span class="s-exp">(</span><span class="core-fn">assoc</span> <span class="keyword">:def-var</span> <span class="boolean">true</span><span class="s-exp">)</span><span class="s-exp">)</span>
                  <span class="symbol">sym</span><span class="s-exp">)</span>
                <span class="keyword">:op</span> <span class="keyword">:var</span><span class="s-exp">)</span>
         <span class="keyword">:doc</span> <span class="symbol">doc</span>
         <span class="keyword">:jsdoc</span> <span class="s-exp">(</span><span class="keyword">:jsdoc</span> <span class="symbol">sym-meta</span><span class="s-exp">)</span><span class="s-exp">}</span>
        <span class="s-exp">(</span><span class="conditional">when-let</span> <span class="s-exp">[</span><span class="symbol">goog-type</span> <span class="s-exp">(</span><span class="keyword">:goog-define</span> <span class="symbol">sym-meta</span><span class="s-exp">)</span><span class="s-exp">]</span>
          <span class="s-exp">{</span><span class="keyword">:goog-define</span> <span class="symbol">goog-type</span><span class="s-exp">}</span><span class="s-exp">)</span>
        <span class="s-exp">(</span><span class="conditional">when</span> <span class="s-exp">(</span><span class="core-fn">true?</span> <span class="s-exp">(</span><span class="keyword">:def-emits-var</span> <span class="symbol">env</span><span class="s-exp">)</span><span class="s-exp">)</span>
          <span class="s-exp">{</span><span class="keyword">:var-ast</span> <span class="s-exp">(</span><span class="symbol">var-ast</span> <span class="symbol">env</span> <span class="symbol">sym</span><span class="s-exp">)</span><span class="s-exp">}</span><span class="s-exp">)</span>
        <span class="s-exp">(</span><span class="conditional">when-some</span> <span class="s-exp">[</span><span class="core-fn">test</span> <span class="s-exp">(</span><span class="keyword">:test</span> <span class="symbol">sym-meta</span><span class="s-exp">)</span><span class="s-exp">]</span>
          <span class="s-exp">{</span><span class="keyword">:test</span> <span class="s-exp">(</span><span class="symbol">analyze</span> <span class="s-exp">(</span><span class="core-fn">assoc</span> <span class="symbol">env</span> <span class="keyword">:context</span> <span class="keyword">:expr</span><span class="s-exp">)</span> <span class="core-fn">test</span><span class="s-exp">)</span><span class="s-exp">}</span><span class="s-exp">)</span>
        <span class="s-exp">(</span><span class="conditional">when</span> <span class="s-exp">(</span><span class="core-fn">some?</span> <span class="symbol">tag</span><span class="s-exp">)</span>
          <span class="s-exp">(</span><span class="special-form">if</span> <span class="symbol">fn-var?</span>
            <span class="s-exp">{</span><span class="keyword">:ret-tag</span> <span class="symbol">tag</span><span class="s-exp">}</span>
            <span class="s-exp">{</span><span class="keyword">:tag</span> <span class="symbol">tag</span><span class="s-exp">}</span><span class="s-exp">)</span><span class="s-exp">)</span>
        <span class="s-exp">(</span><span class="conditional">when</span> <span class="s-exp">(</span><span class="core-fn">true?</span> <span class="symbol">dynamic</span><span class="s-exp">)</span> <span class="s-exp">{</span><span class="keyword">:dynamic</span> <span class="boolean">true</span><span class="s-exp">}</span><span class="s-exp">)</span>
        <span class="s-exp">(</span><span class="conditional">when</span> <span class="s-exp">(</span><span class="core-fn">some?</span> <span class="symbol">export-as</span><span class="s-exp">)</span> <span class="s-exp">{</span><span class="keyword">:export</span> <span class="symbol">export-as</span><span class="s-exp">}</span><span class="s-exp">)</span>
        <span class="s-exp">(</span><span class="special-form">if</span> <span class="s-exp">(</span><span class="core-fn">some?</span> <span class="symbol">init-expr</span><span class="s-exp">)</span>
          <span class="s-exp">{</span><span class="keyword">:init</span> <span class="symbol">init-expr</span>
           <span class="keyword">:children</span> <span class="s-exp">[</span><span class="keyword">:var</span> <span class="keyword">:init</span><span class="s-exp">]</span><span class="s-exp">}</span>
          <span class="s-exp">{</span><span class="keyword">:children</span> <span class="s-exp">[</span><span class="keyword">:var</span><span class="s-exp">]</span><span class="s-exp">}</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span></code></pre><hr /><div>Emitting code @ <a href="https://github.com/clojure/clojurescript/blob/r1.11.51/src/main/clojure/cljs/compiler.cljc#L813-L851">clojurescript:src/main/clojure/cljs/compiler.cljc</a></div><pre><code class="syntax"><span class="s-exp">(</span><span class="definition">defmethod</span> <span class="symbol">emit*</span> <span class="keyword">:def</span>
  <span class="s-exp">[</span><span class="s-exp">{</span><span class="keyword">:keys</span> <span class="s-exp">[</span><span class="core-fn">name</span> <span class="special-form">var</span> <span class="symbol">init</span> <span class="symbol">env</span> <span class="symbol">doc</span> <span class="symbol">goog-define</span> <span class="symbol">jsdoc</span> <span class="symbol">export</span> <span class="core-fn">test</span> <span class="symbol">var-ast</span><span class="s-exp">]</span><span class="s-exp">}</span><span class="s-exp">]</span>
  <span class="comment">;; We only want to emit if an init is supplied, this is to avoid dead code
</span>  <span class="comment">;; elimination issues. The REPL is the exception to this rule.
</span>  <span class="s-exp">(</span><span class="conditional">when</span> <span class="s-exp">(</span><span class="macro">or</span> <span class="symbol">init</span> <span class="s-exp">(</span><span class="keyword">:def-emits-var</span> <span class="symbol">env</span><span class="s-exp">)</span><span class="s-exp">)</span>
    <span class="s-exp">(</span><span class="special-form">let</span> <span class="s-exp">[</span><span class="symbol">mname</span> <span class="s-exp">(</span><span class="core-fn">munge</span> <span class="core-fn">name</span><span class="s-exp">)</span><span class="s-exp">]</span>
      <span class="s-exp">(</span><span class="symbol">emit-comment</span> <span class="symbol">env</span> <span class="symbol">doc</span> <span class="s-exp">(</span><span class="core-fn">concat</span>
                              <span class="s-exp">(</span><span class="conditional">when</span> <span class="symbol">goog-define</span>
                                <span class="s-exp">[</span><span class="s-exp">(</span><span class="core-fn">str</span> <span class="string">"@define {"</span> <span class="symbol">goog-define</span> <span class="string">"}"</span><span class="s-exp">)</span><span class="s-exp">]</span><span class="s-exp">)</span>
                              <span class="symbol">jsdoc</span> <span class="s-exp">(</span><span class="keyword">:jsdoc</span> <span class="symbol">init</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
      <span class="s-exp">(</span><span class="conditional">when</span> <span class="s-exp">(</span><span class="core-fn">=</span> <span class="keyword">:return</span> <span class="s-exp">(</span><span class="keyword">:context</span> <span class="symbol">env</span><span class="s-exp">)</span><span class="s-exp">)</span>
        <span class="s-exp">(</span><span class="symbol">emitln</span> <span class="string">"return ("</span><span class="s-exp">)</span><span class="s-exp">)</span>
      <span class="s-exp">(</span><span class="conditional">when</span> <span class="s-exp">(</span><span class="keyword">:def-emits-var</span> <span class="symbol">env</span><span class="s-exp">)</span>
        <span class="s-exp">(</span><span class="symbol">emitln</span> <span class="string">"(function (){"</span><span class="s-exp">)</span><span class="s-exp">)</span>
      <span class="s-exp">(</span><span class="symbol">emits</span> <span class="special-form">var</span><span class="s-exp">)</span>
      <span class="s-exp">(</span><span class="conditional">when</span> <span class="symbol">init</span>
        <span class="s-exp">(</span><span class="symbol">emits</span> <span class="string">" = "</span>
          <span class="s-exp">(</span><span class="conditional">if-let</span> <span class="s-exp">[</span><span class="symbol">define</span> <span class="s-exp">(</span><span class="symbol">get-define</span> <span class="symbol">mname</span> <span class="symbol">jsdoc</span><span class="s-exp">)</span><span class="s-exp">]</span>
            <span class="symbol">define</span>
            <span class="symbol">init</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
      <span class="s-exp">(</span><span class="conditional">when</span> <span class="s-exp">(</span><span class="keyword">:def-emits-var</span> <span class="symbol">env</span><span class="s-exp">)</span>
        <span class="s-exp">(</span><span class="symbol">emitln</span> <span class="string">"; return ("</span><span class="s-exp">)</span>
        <span class="s-exp">(</span><span class="symbol">emits</span> <span class="s-exp">(</span><span class="core-fn">merge</span>
                 <span class="s-exp">{</span><span class="keyword">:op</span>  <span class="keyword">:the-var</span>
                  <span class="keyword">:env</span> <span class="s-exp">(</span><span class="core-fn">assoc</span> <span class="symbol">env</span> <span class="keyword">:context</span> <span class="keyword">:expr</span><span class="s-exp">)</span><span class="s-exp">}</span>
                 <span class="symbol">var-ast</span><span class="s-exp">)</span><span class="s-exp">)</span>
        <span class="s-exp">(</span><span class="symbol">emitln</span> <span class="string">");})()"</span><span class="s-exp">)</span><span class="s-exp">)</span>
      <span class="s-exp">(</span><span class="conditional">when</span> <span class="s-exp">(</span><span class="core-fn">=</span> <span class="keyword">:return</span> <span class="s-exp">(</span><span class="keyword">:context</span> <span class="symbol">env</span><span class="s-exp">)</span><span class="s-exp">)</span>
        <span class="s-exp">(</span><span class="symbol">emitln</span> <span class="string">")"</span><span class="s-exp">)</span><span class="s-exp">)</span>
      <span class="comment">;; NOTE: JavaScriptCore does not like this under advanced compilation
</span>      <span class="comment">;; this change was primarily for REPL interactions - David
</span>      <span class="comment">;(emits " = (typeof " mname " != 'undefined') ? " mname " : undefined")
</span>      <span class="s-exp">(</span><span class="conditional">when-not</span> <span class="s-exp">(</span><span class="core-fn">=</span> <span class="keyword">:expr</span> <span class="s-exp">(</span><span class="keyword">:context</span> <span class="symbol">env</span><span class="s-exp">)</span><span class="s-exp">)</span> <span class="s-exp">(</span><span class="symbol">emitln</span> <span class="string">";"</span><span class="s-exp">)</span><span class="s-exp">)</span>
      <span class="s-exp">(</span><span class="conditional">when</span> <span class="symbol">export</span>
        <span class="s-exp">(</span><span class="symbol">emitln</span> <span class="string">"goog.exportSymbol('"</span> <span class="s-exp">(</span><span class="core-fn">munge</span> <span class="symbol">export</span><span class="s-exp">)</span> <span class="string">"', "</span> <span class="symbol">mname</span> <span class="string">");"</span><span class="s-exp">)</span><span class="s-exp">)</span>
      <span class="s-exp">(</span><span class="conditional">when</span> <span class="s-exp">(</span><span class="macro">and</span> <span class="symbol">ana/*load-tests*</span> <span class="core-fn">test</span><span class="s-exp">)</span>
        <span class="s-exp">(</span><span class="conditional">when</span> <span class="s-exp">(</span><span class="core-fn">=</span> <span class="keyword">:expr</span> <span class="s-exp">(</span><span class="keyword">:context</span> <span class="symbol">env</span><span class="s-exp">)</span><span class="s-exp">)</span>
          <span class="s-exp">(</span><span class="symbol">emitln</span> <span class="string">";"</span><span class="s-exp">)</span><span class="s-exp">)</span>
        <span class="s-exp">(</span><span class="symbol">emitln</span> <span class="special-form">var</span> <span class="string">".cljs$lang$test = "</span> <span class="core-fn">test</span> <span class="string">";"</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span></code></pre><hr /></div><footer class="site-footer"><div class="wrapper"><hr /><div class="cljs-legal">ClojureScript is licensed <a href="http://opensource.org/licenses/eclipse-1.0.php">EPL 1.0</a><br />Copyright  Rich Hickey</div></div></footer></div><script src="/js/client.js"></script></body></html>