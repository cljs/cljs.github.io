<html><head><meta charset="utf-8" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><meta content="width=device-width, initial-scale=1" name="viewport" /><title>ObjMap</title><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700" rel="stylesheet" /><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet" /><link href="/css/normalize.css" rel="stylesheet" /><link href="/css/skeleton.css" rel="stylesheet" /><link href="/css/custom.css" rel="stylesheet" /><link href="/css/github-theme.css" rel="stylesheet" /><link href="/img/icons/apple-touch-icon-57x57.png" rel="apple-touch-icon" sizes="57x57" /><link href="/img/icons/apple-touch-icon-114x114.png" rel="apple-touch-icon" sizes="114x114" /><link href="/img/icons/apple-touch-icon-72x72.png" rel="apple-touch-icon" sizes="72x72" /><link href="/img/icons/apple-touch-icon-144x144.png" rel="apple-touch-icon" sizes="144x144" /><link href="/img/icons/apple-touch-icon-60x60.png" rel="apple-touch-icon" sizes="60x60" /><link href="/img/icons/apple-touch-icon-120x120.png" rel="apple-touch-icon" sizes="120x120" /><link href="/img/icons/apple-touch-icon-76x76.png" rel="apple-touch-icon" sizes="76x76" /><link href="/img/icons/apple-touch-icon-152x152.png" rel="apple-touch-icon" sizes="152x152" /><link href="/img/icons/apple-touch-icon-180x180.png" rel="apple-touch-icon" sizes="180x180" /><link href="/img/icons/favicon-192x192.png" rel="icon" sizes="192x192" type="image/png" /><link href="/img/icons/favicon-160x160.png" rel="icon" sizes="160x160" type="image/png" /><link href="/img/icons/favicon-96x96.png" rel="icon" sizes="96x96" type="image/png" /><link href="/img/icons/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" /><link href="/img/icons/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" /></head><body><div class="container"><nav class="navbar"><div class="container"><ul class="navbar-list"><li class="navbar-item"><a class="navbar-link-logo"><img class="navbar-logo" src="/img/cljs-white.svg" /></a></li><li class="navbar-item"><a class="navbar-title">ClojureScript</a></li><li class="navbar-item"><a class="navbar-link" href="/api">API</a></li><li class="navbar-item"><a class="navbar-link" href="https://github.com/clojure/clojurescript" target="_blank">GitHub</a></li></ul></div></nav><div><h1 class="r">ObjMap</h1><table><tr><td>type</td><td>since v0.0-927</td><td><a href="https://github.com/cljs/api/blob/master/docfiles/cljs.core/ObjMap.md">Edit</a></td></tr></table><div><em>satisfies <a class="code-link" href="/api/cljs.core#IAssociative"><code>IAssociative</code></a> <a class="code-link" href="/api/cljs.core#ICloneable"><code>ICloneable</code></a> <a class="code-link" href="/api/cljs.core#ICollection"><code>ICollection</code></a> <a class="code-link" href="/api/cljs.core#ICounted"><code>ICounted</code></a> <a class="code-link" href="/api/cljs.core#IEditableCollection"><code>IEditableCollection</code></a> <a class="code-link" href="/api/cljs.core#IEmptyableCollection"><code>IEmptyableCollection</code></a> <a class="code-link" href="/api/cljs.core#IEquiv"><code>IEquiv</code></a> <a class="code-link" href="/api/cljs.core#IFind"><code>IFind</code></a> <a class="code-link" href="/api/cljs.core#IFn"><code>IFn</code></a> <a class="code-link" href="/api/cljs.core#IHash"><code>IHash</code></a> <a class="code-link" href="/api/cljs.core#IIterable"><code>IIterable</code></a> <a class="code-link" href="/api/cljs.core#IKVReduce"><code>IKVReduce</code></a> <a class="code-link" href="/api/cljs.core#ILookup"><code>ILookup</code></a> <a class="code-link" href="/api/cljs.core#IMap"><code>IMap</code></a> <a class="code-link" href="/api/cljs.core#IMeta"><code>IMeta</code></a> <a class="code-link" href="/api/cljs.core#IPrintWithWriter"><code>IPrintWithWriter</code></a> <a class="code-link" href="/api/cljs.core#IReduce"><code>IReduce</code></a> <a class="code-link" href="/api/cljs.core#ISeqable"><code>ISeqable</code></a> <a class="code-link" href="/api/cljs.core#ITransientAssociative"><code>ITransientAssociative</code></a> <a class="code-link" href="/api/cljs.core#ITransientCollection"><code>ITransientCollection</code></a> <a class="code-link" href="/api/cljs.core#ITransientMap"><code>ITransientMap</code></a> <a class="code-link" href="/api/cljs.core#IWithMeta"><code>IWithMeta</code></a></em></div><hr /><div><code>(ObjMap. meta strkeys strobj __hash)</code></div><hr /><div>Source code @ <a href="https://github.com/clojure/clojurescript/blob/r1.12.134/src/main/cljs/cljs/core.cljs#L12612-L12778">clojurescript:src/main/cljs/cljs/core.cljs</a></div><pre><code class="syntax">(deftype ObjMap [meta strkeys strobj ^:mutable __hash]
  Object
  (toString [coll]
    (pr-str* coll))
  (keys [coll]
    (es6-iterator
      (prim-seq
        (.map (.sort strkeys obj-map-compare-keys)
          obj-map-key->keyword))))
  (entries [coll]
    (es6-entries-iterator (-seq coll)))
  (values [coll]
    (es6-iterator
      (prim-seq
        (.map (.sort strkeys obj-map-compare-keys)
          #(unchecked-get strobj %)))))
  (has [coll k]
    (contains? coll k))
  (get [coll k not-found]
    (-lookup coll k not-found))
  (forEach [coll f]
    (.forEach (.sort strkeys obj-map-compare-keys)
      #(f (unchecked-get strobj %) (obj-map-key->keyword %))))

  IWithMeta
  (-with-meta [coll meta] (ObjMap. meta strkeys strobj __hash))

  IMeta
  (-meta [coll] meta)

  ICloneable
  (-clone [coll] (ObjMap. meta strkeys strobj __hash))

  ICollection
  (-conj [coll entry]
    (if (vector? entry)
      (-assoc coll (-nth entry 0) (-nth entry 1))
      (reduce -conj coll entry)))

  IEmptyableCollection
  (-empty [coll] (-with-meta (. ObjMap -EMPTY) meta))

  IEquiv
  (-equiv [coll other] (equiv-map coll other))

  IHash
  (-hash [coll] (caching-hash coll hash-unordered-coll __hash))

  ISeqable
  (-seq [coll]
    (when (pos? (alength strkeys))
      (prim-seq
        (.map (.sort strkeys obj-map-compare-keys)
          #(MapEntry. (obj-map-key->keyword %) (unchecked-get strobj %) nil)))))

  ICounted
  (-count [coll] (alength strkeys))

  ILookup
  (-lookup [coll k] (-lookup coll k nil))
  (-lookup [coll k not-found]
    (let [k (if-not (keyword? k) k (keyword->obj-map-key k))]
      (if (and (string? k)
               (not (nil? (scan-array 1 k strkeys))))
        (unchecked-get strobj k)
        not-found)))

  IAssociative
  (-assoc [coll k v]
    (let [k (if-not (keyword? k) k (keyword->obj-map-key k))]
      (if (string? k)
        (if-not (nil? (scan-array 1 k strkeys))
          (if (identical? v (gobject/get strobj k))
            coll
            ; overwrite
            (let [new-strobj (obj-clone strobj strkeys)]
              (gobject/set new-strobj k v)
              (ObjMap. meta strkeys new-strobj nil))) 
          ; append
          (let [new-strobj (obj-clone strobj strkeys) 
                new-keys (aclone strkeys)]
            (gobject/set new-strobj k v)
            (.push new-keys k)
            (ObjMap. meta new-keys new-strobj nil)))
        ; non-string key. game over.
        (-with-meta
          (-kv-reduce coll
            (fn [ret k v]
              (-assoc ret k v))
            (hash-map-lite k v))
          meta))))
  (-contains-key? [coll k]
    (let [k (if-not (keyword? k) k (keyword->obj-map-key k))]
      (if (and (string? k)
               (not (nil? (scan-array 1 k strkeys))))
        true
        false)))

  IFind
  (-find [coll k]
    (let [k' (if-not (keyword? k) k (keyword->obj-map-key k))]
      (when (and (string? k')
                 (not (nil? (scan-array 1 k' strkeys))))
        (MapEntry. k (unchecked-get strobj k') nil))))

  IKVReduce
  (-kv-reduce [coll f init]
    (let [len (alength strkeys)]
      (loop [keys (.sort strkeys obj-map-compare-keys)
             init init]
        (if (seq keys)
          (let [k (first keys)
                init (f init (obj-map-key->keyword k) (unchecked-get strobj k))]
            (if (reduced? init)
              @init
              (recur (rest keys) init)))
          init))))

  IIterable
  (-iterator [coll]
    (ObjMapIterator. strkeys strobj 0))

  IReduce
  (-reduce [coll f]
    (iter-reduce coll f))
  (-reduce [coll f start]
    (iter-reduce coll f start))

  IMap
  (-dissoc [coll k]
    (let [k (if-not (keyword? k) k (keyword->obj-map-key k))]
      (if (and (string? k)
               (not (nil? (scan-array 1 k strkeys))))
        (let [new-keys (aclone strkeys)
              new-strobj (obj-clone strobj strkeys)]
          (.splice new-keys (scan-array 1 k new-keys) 1)
          (js-delete new-strobj k)
          (ObjMap. meta new-keys new-strobj nil))
        coll))) ; key not found, return coll unchanged

  IFn
  (-invoke [coll k]
    (-lookup coll k))
  (-invoke [coll k not-found]
    (-lookup coll k not-found))

  IEditableCollection
  (-as-transient [coll]
    coll)

  ITransientCollection
  (-conj! [coll val]
    (-conj coll val))
  (-persistent! [coll]
    coll)

  ITransientAssociative
  (-assoc! [coll key val]
    (-assoc coll key val))

  ITransientMap
  (-dissoc! [coll key]
    (-dissoc coll key))

  IPrintWithWriter
  (-pr-writer [coll writer opts]
    (print-map coll pr-writer writer opts)))</code></pre><hr /></div><footer class="site-footer"><div class="wrapper"><hr /><div class="cljs-legal">ClojureScript is licensed <a href="http://opensource.org/licenses/eclipse-1.0.php">EPL 1.0</a><br />Copyright Â© Rich Hickey</div></div></footer></div><script src="/js/client.js"></script></body></html>