<html><head><meta charset="utf-8" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><meta content="width=device-width, initial-scale=1" name="viewport" /><title>defprotocol</title><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700" rel="stylesheet" /><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet" /><link href="/css/normalize.css" rel="stylesheet" /><link href="/css/skeleton.css" rel="stylesheet" /><link href="/css/custom.css" rel="stylesheet" /><link href="/css/github-theme.css" rel="stylesheet" /><link href="/img/icons/apple-touch-icon-57x57.png" rel="apple-touch-icon" sizes="57x57" /><link href="/img/icons/apple-touch-icon-114x114.png" rel="apple-touch-icon" sizes="114x114" /><link href="/img/icons/apple-touch-icon-72x72.png" rel="apple-touch-icon" sizes="72x72" /><link href="/img/icons/apple-touch-icon-144x144.png" rel="apple-touch-icon" sizes="144x144" /><link href="/img/icons/apple-touch-icon-60x60.png" rel="apple-touch-icon" sizes="60x60" /><link href="/img/icons/apple-touch-icon-120x120.png" rel="apple-touch-icon" sizes="120x120" /><link href="/img/icons/apple-touch-icon-76x76.png" rel="apple-touch-icon" sizes="76x76" /><link href="/img/icons/apple-touch-icon-152x152.png" rel="apple-touch-icon" sizes="152x152" /><link href="/img/icons/apple-touch-icon-180x180.png" rel="apple-touch-icon" sizes="180x180" /><link href="/img/icons/favicon-192x192.png" rel="icon" sizes="192x192" type="image/png" /><link href="/img/icons/favicon-160x160.png" rel="icon" sizes="160x160" type="image/png" /><link href="/img/icons/favicon-96x96.png" rel="icon" sizes="96x96" type="image/png" /><link href="/img/icons/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" /><link href="/img/icons/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" /></head><body><div class="container"><nav class="navbar"><div class="container"><ul class="navbar-list"><li class="navbar-item"><a class="navbar-link-logo"><img class="navbar-logo" src="/img/cljs-white.svg" /></a></li><li class="navbar-item"><a class="navbar-title">ClojureScript</a></li><li class="navbar-item"><a class="navbar-link" href="/api">API</a></li><li class="navbar-item"><a class="navbar-link" href="https://github.com/clojure/clojurescript" target="_blank">GitHub</a></li></ul></div></nav><div><h1 class="r">defprotocol</h1><table><tr><td>macro</td><td>since v0.0-927</td><td><a href="http://clojure.github.io/clojure/branch-master/clojure.core-api.html#clojure.core/defprotocol"><img height="24px" src="/img/clojure-icon.gif" valign="middle" /> clojure.core/defprotocol</a></td><td><a href="https://github.com/cljs/api/blob/master/docfiles/cljs.core/defprotocol.md">Edit</a></td></tr></table><div><code>(defprotocol psym & doc+methods)</code></div><hr />Source docstring:<pre>A protocol is a named set of named methods and their signatures:

(defprotocol AProtocolName
  ;optional doc string
  "A doc string for AProtocol abstraction"

;method signatures
  (bar [this a b] "bar docs")
  (baz [this a] [this a b] [this a b c] "baz docs"))

No implementations are provided. Docs can be specified for the
protocol overall and for each method. The above yields a set of
polymorphic functions and a protocol object. All are
namespace-qualified by the ns enclosing the definition The resulting
functions dispatch on the type of their first argument, which is
required and corresponds to the implicit target object ('this' in
JavaScript parlance). defprotocol is dynamic, has no special compile-time
effect, and defines no new types.

(defprotocol P
  (foo [this])
  (bar-me [this] [this y]))

(deftype Foo [a b c]
  P
  (foo [this] a)
  (bar-me [this] b)
  (bar-me [this y] (+ c y)))

(bar-me (Foo. 1 2 3) 42)
=> 45

(foo
  (let [x 42]
    (reify P
      (foo [this] 17)
      (bar-me [this] x)
      (bar-me [this y] x))))
=> 17</pre><div>Source code @ <a href="https://github.com/clojure/clojurescript/blob/r1.12.116/src/main/clojure/cljs/core.cljc#L2040-L2224">clojurescript:src/main/clojure/cljs/core.cljc</a></div><pre><code class="syntax"><span class="s-exp">(</span><span class="symbol">core/defmacro</span> <span class="definition">defprotocol</span>
  <span class="s-exp">[</span><span class="symbol">psym</span> <span class="reader-char">&</span> <span class="symbol">doc+methods</span><span class="s-exp">]</span>
  <span class="s-exp">(</span><span class="symbol">core/let</span> <span class="s-exp">[</span><span class="symbol">p</span> <span class="s-exp">(</span><span class="keyword">:name</span> <span class="s-exp">(</span><span class="symbol">cljs.analyzer/resolve-var</span> <span class="s-exp">(</span><span class="core-fn">dissoc</span> <span class="symbol">&env</span> <span class="keyword">:locals</span><span class="s-exp">)</span> <span class="symbol">psym</span><span class="s-exp">)</span><span class="s-exp">)</span>
             <span class="s-exp">[</span><span class="symbol">opts</span> <span class="core-fn">methods</span><span class="s-exp">]</span>
             <span class="s-exp">(</span><span class="symbol">core/loop</span> <span class="s-exp">[</span><span class="symbol">opts</span> <span class="s-exp">{</span><span class="keyword">:protocol-symbol</span> <span class="boolean">true</span><span class="s-exp">}</span>
                         <span class="core-fn">methods</span> <span class="s-exp">[</span><span class="s-exp">]</span>
                         <span class="symbol">sigs</span> <span class="symbol">doc+methods</span><span class="s-exp">]</span>
               <span class="s-exp">(</span><span class="symbol">core/if-not</span> <span class="s-exp">(</span><span class="core-fn">seq</span> <span class="symbol">sigs</span><span class="s-exp">)</span>
                 <span class="s-exp">[</span><span class="symbol">opts</span> <span class="core-fn">methods</span><span class="s-exp">]</span>
                 <span class="s-exp">(</span><span class="symbol">core/let</span> <span class="s-exp">[</span><span class="s-exp">[</span><span class="symbol">head</span> <span class="reader-char">&</span> <span class="symbol">tail</span><span class="s-exp">]</span> <span class="symbol">sigs</span><span class="s-exp">]</span>
                   <span class="s-exp">(</span><span class="symbol">core/cond</span>
                     <span class="s-exp">(</span><span class="symbol">core/string?</span> <span class="symbol">head</span><span class="s-exp">)</span>
                     <span class="s-exp">(</span><span class="special-form">recur</span> <span class="s-exp">(</span><span class="core-fn">assoc</span> <span class="symbol">opts</span> <span class="keyword">:doc</span> <span class="symbol">head</span><span class="s-exp">)</span> <span class="core-fn">methods</span> <span class="symbol">tail</span><span class="s-exp">)</span>
                     <span class="s-exp">(</span><span class="symbol">core/keyword?</span> <span class="symbol">head</span><span class="s-exp">)</span>
                     <span class="s-exp">(</span><span class="special-form">recur</span> <span class="s-exp">(</span><span class="core-fn">assoc</span> <span class="symbol">opts</span> <span class="symbol">head</span> <span class="s-exp">(</span><span class="core-fn">first</span> <span class="symbol">tail</span><span class="s-exp">)</span><span class="s-exp">)</span> <span class="core-fn">methods</span> <span class="s-exp">(</span><span class="core-fn">rest</span> <span class="symbol">tail</span><span class="s-exp">)</span><span class="s-exp">)</span>
                     <span class="s-exp">(</span><span class="symbol">core/seq?</span> <span class="symbol">head</span><span class="s-exp">)</span>
                     <span class="s-exp">(</span><span class="special-form">recur</span> <span class="symbol">opts</span> <span class="s-exp">(</span><span class="core-fn">conj</span> <span class="core-fn">methods</span> <span class="symbol">head</span><span class="s-exp">)</span> <span class="symbol">tail</span><span class="s-exp">)</span>
                     <span class="keyword">:else</span>
                     <span class="s-exp">(</span><span class="exception">throw</span> <span class="reader-char">#</span><span class="symbol">?</span><span class="s-exp">(</span><span class="keyword">:clj</span>  <span class="s-exp">(</span><span class="symbol">Exception.</span>
                                       <span class="s-exp">(</span><span class="symbol">core/str</span> <span class="string">"Invalid protocol, "</span> <span class="symbol">psym</span> <span class="string">" received unexpected argument"</span><span class="s-exp">)</span><span class="s-exp">)</span>
                               <span class="keyword">:cljs</span> <span class="s-exp">(</span><span class="symbol">js/Error.</span>
                                       <span class="s-exp">(</span><span class="symbol">core/str</span> <span class="string">"Invalid protocol, "</span> <span class="symbol">psym</span> <span class="string">" received unexpected argument"</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
                     <span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
             <span class="symbol">psym</span> <span class="s-exp">(</span><span class="core-fn">vary-meta</span> <span class="symbol">psym</span> <span class="core-fn">merge</span> <span class="symbol">opts</span><span class="s-exp">)</span>
             <span class="core-fn">ns-name</span> <span class="s-exp">(</span><span class="symbol">core/-></span> <span class="symbol">&env</span> <span class="keyword">:ns</span> <span class="keyword">:name</span><span class="s-exp">)</span>
             <span class="symbol">fqn</span> <span class="s-exp">(</span><span class="symbol">core/fn</span> <span class="s-exp">[</span><span class="symbol">n</span><span class="s-exp">]</span> <span class="s-exp">(</span><span class="core-fn">symbol</span> <span class="s-exp">(</span><span class="symbol">core/str</span> <span class="core-fn">ns-name</span><span class="s-exp">)</span> <span class="s-exp">(</span><span class="symbol">core/str</span> <span class="symbol">n</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
             <span class="symbol">prefix</span> <span class="s-exp">(</span><span class="symbol">protocol-prefix</span> <span class="symbol">p</span><span class="s-exp">)</span>
             <span class="symbol">_</span> <span class="s-exp">(</span><span class="symbol">core/doseq</span> <span class="s-exp">[</span><span class="s-exp">[</span><span class="symbol">mname</span> <span class="reader-char">&</span> <span class="symbol">arities</span><span class="s-exp">]</span> <span class="core-fn">methods</span><span class="s-exp">]</span>
                 <span class="s-exp">(</span><span class="symbol">core/when</span> <span class="s-exp">(</span><span class="core-fn">some</span> <span class="s-exp">#{</span><span class="number">0</span><span class="s-exp">}</span> <span class="s-exp">(</span><span class="core-fn">map</span> <span class="core-fn">count</span> <span class="s-exp">(</span><span class="core-fn">filter</span> <span class="core-fn">vector?</span> <span class="symbol">arities</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
                   <span class="s-exp">(</span><span class="exception">throw</span>
                     <span class="reader-char">#</span><span class="symbol">?</span><span class="s-exp">(</span><span class="keyword">:clj</span> <span class="s-exp">(</span><span class="symbol">Exception.</span>
                               <span class="s-exp">(</span><span class="symbol">core/str</span> <span class="string">"Invalid protocol, "</span> <span class="symbol">psym</span>
                                 <span class="string">" defines method "</span> <span class="symbol">mname</span> <span class="string">" with arity 0"</span><span class="s-exp">)</span><span class="s-exp">)</span>
                        <span class="keyword">:cljs</span> <span class="s-exp">(</span><span class="symbol">js/Error.</span>
                                <span class="s-exp">(</span><span class="symbol">core/str</span> <span class="string">"Invalid protocol, "</span> <span class="symbol">psym</span>
                                  <span class="string">" defines method "</span> <span class="symbol">mname</span> <span class="string">" with arity 0"</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
             <span class="symbol">sig->syms</span> <span class="s-exp">(</span><span class="symbol">core/fn</span> <span class="s-exp">[</span><span class="symbol">sig</span><span class="s-exp">]</span>
                         <span class="s-exp">(</span><span class="symbol">core/if-not</span> <span class="s-exp">(</span><span class="core-fn">every?</span> <span class="symbol">core/symbol?</span> <span class="symbol">sig</span><span class="s-exp">)</span>
                           <span class="s-exp">(</span><span class="core-fn">mapv</span> <span class="s-exp">(</span><span class="symbol">core/fn</span> <span class="s-exp">[</span><span class="symbol">arg</span><span class="s-exp">]</span>
                                   <span class="s-exp">(</span><span class="symbol">core/cond</span>
                                     <span class="s-exp">(</span><span class="symbol">core/symbol?</span> <span class="symbol">arg</span><span class="s-exp">)</span> <span class="symbol">arg</span>
                                     <span class="s-exp">(</span><span class="symbol">core/and</span> <span class="s-exp">(</span><span class="core-fn">map?</span> <span class="symbol">arg</span><span class="s-exp">)</span> <span class="s-exp">(</span><span class="symbol">core/some?</span> <span class="s-exp">(</span><span class="keyword">:as</span> <span class="symbol">arg</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span> <span class="s-exp">(</span><span class="keyword">:as</span> <span class="symbol">arg</span><span class="s-exp">)</span>
                                     <span class="keyword">:else</span> <span class="s-exp">(</span><span class="core-fn">gensym</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span> <span class="symbol">sig</span><span class="s-exp">)</span>
                           <span class="symbol">sig</span><span class="s-exp">)</span><span class="s-exp">)</span>
             <span class="symbol">expand-dyn</span> <span class="s-exp">(</span><span class="symbol">core/fn</span> <span class="s-exp">[</span><span class="symbol">fname</span> <span class="symbol">sig</span><span class="s-exp">]</span>
                          <span class="s-exp">(</span><span class="symbol">core/let</span> <span class="s-exp">[</span><span class="symbol">sig</span> <span class="s-exp">(</span><span class="symbol">sig->syms</span> <span class="symbol">sig</span><span class="s-exp">)</span>

                                     <span class="symbol">fqn-fname</span> <span class="s-exp">(</span><span class="core-fn">with-meta</span> <span class="s-exp">(</span><span class="symbol">fqn</span> <span class="symbol">fname</span><span class="s-exp">)</span> <span class="s-exp">{</span><span class="keyword">:cljs.analyzer/no-resolve</span> <span class="boolean">true</span><span class="s-exp">}</span><span class="s-exp">)</span>
                                     <span class="symbol">fsig</span> <span class="s-exp">(</span><span class="core-fn">first</span> <span class="symbol">sig</span><span class="s-exp">)</span>

                                     <span class="comment">;; construct protocol checks in reverse order
</span>                                     <span class="comment">;; check the.protocol/fn["_"] for default impl last
</span>                                     <span class="symbol">check</span>
                                     <span class="reader-char">`</span><span class="s-exp">(</span><span class="special-form">let</span> <span class="s-exp">[</span>m<span class="reader-char">#</span> <span class="s-exp">(</span><span class="symbol">unchecked-get</span> <span class="reader-char">~</span><span class="symbol">fqn-fname</span> <span class="string">"_"</span><span class="s-exp">)</span><span class="s-exp">]</span>
                                        <span class="s-exp">(</span><span class="conditional">if-not</span> <span class="s-exp">(</span><span class="core-fn">nil?</span> m<span class="reader-char">#</span><span class="s-exp">)</span>
                                          <span class="s-exp">(</span>m<span class="reader-char">#</span> <span class="reader-char">~@</span><span class="symbol">sig</span><span class="s-exp">)</span>
                                          <span class="s-exp">(</span><span class="exception">throw</span>
                                            <span class="s-exp">(</span><span class="symbol">missing-protocol</span>
                                              <span class="reader-char">~</span><span class="s-exp">(</span><span class="symbol">core/str</span> <span class="symbol">psym</span> <span class="string">"."</span> <span class="symbol">fname</span><span class="s-exp">)</span> <span class="reader-char">~</span><span class="symbol">fsig</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>

                                     <span class="comment">;; then check protocol on js string,function,array,object (first dynamic check actually executed)
</span>                                     <span class="symbol">check</span>
                                     <span class="reader-char">`</span><span class="s-exp">(</span><span class="special-form">let</span> <span class="s-exp">[</span>x<span class="reader-char">#</span> <span class="s-exp">(</span><span class="special-form">if</span> <span class="s-exp">(</span><span class="core-fn">nil?</span> <span class="reader-char">~</span><span class="symbol">fsig</span><span class="s-exp">)</span> <span class="nil">nil</span> <span class="reader-char">~</span><span class="symbol">fsig</span><span class="s-exp">)</span>
                                            m<span class="reader-char">#</span> <span class="s-exp">(</span><span class="symbol">unchecked-get</span> <span class="reader-char">~</span><span class="symbol">fqn-fname</span> <span class="s-exp">(</span><span class="symbol">goog/typeOf</span> x<span class="reader-char">#</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">]</span>
                                        <span class="s-exp">(</span><span class="conditional">if-not</span> <span class="s-exp">(</span><span class="core-fn">nil?</span> m<span class="reader-char">#</span><span class="s-exp">)</span>
                                          <span class="s-exp">(</span>m<span class="reader-char">#</span> <span class="reader-char">~@</span><span class="symbol">sig</span><span class="s-exp">)</span>
                                          <span class="reader-char">~</span><span class="symbol">check</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">]</span>
                            <span class="reader-char">`</span><span class="s-exp">(</span><span class="reader-char">~</span><span class="symbol">sig</span> <span class="reader-char">~</span><span class="symbol">check</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
             <span class="symbol">expand-sig</span> <span class="s-exp">(</span><span class="symbol">core/fn</span> <span class="s-exp">[</span><span class="symbol">fname</span> <span class="symbol">dyn-name</span> <span class="symbol">slot</span> <span class="symbol">sig</span><span class="s-exp">]</span>
                          <span class="s-exp">(</span><span class="symbol">core/let</span> <span class="s-exp">[</span><span class="symbol">sig</span> <span class="s-exp">(</span><span class="symbol">sig->syms</span> <span class="symbol">sig</span><span class="s-exp">)</span>

                                     <span class="symbol">fqn-fname</span> <span class="s-exp">(</span><span class="core-fn">with-meta</span> <span class="s-exp">(</span><span class="symbol">fqn</span> <span class="symbol">fname</span><span class="s-exp">)</span> <span class="s-exp">{</span><span class="keyword">:cljs.analyzer/no-resolve</span> <span class="boolean">true</span><span class="s-exp">}</span><span class="s-exp">)</span>
                                     <span class="symbol">fsig</span> <span class="s-exp">(</span><span class="core-fn">first</span> <span class="symbol">sig</span><span class="s-exp">)</span>

                                     <span class="comment">;; check protocol property on object (first check executed)
</span>                                     <span class="symbol">check</span>
                                     <span class="reader-char">`</span><span class="s-exp">(</span><span class="special-form">if</span> <span class="s-exp">(</span><span class="macro">and</span> <span class="s-exp">(</span><span class="core-fn">not</span> <span class="s-exp">(</span><span class="core-fn">nil?</span> <span class="reader-char">~</span><span class="symbol">fsig</span><span class="s-exp">)</span><span class="s-exp">)</span>
                                               <span class="comment">;; Property access needed here.
</span>                                               <span class="s-exp">(</span><span class="core-fn">not</span> <span class="s-exp">(</span><span class="core-fn">nil?</span> <span class="s-exp">(</span><span class="special-form">.</span> <span class="reader-char">~</span><span class="symbol">fsig</span> <span class="reader-char">~</span><span class="s-exp">(</span><span class="core-fn">with-meta</span> <span class="s-exp">(</span><span class="core-fn">symbol</span> <span class="s-exp">(</span><span class="symbol">core/str</span> <span class="string">"-"</span> <span class="symbol">slot</span><span class="s-exp">)</span><span class="s-exp">)</span> <span class="s-exp">{</span><span class="keyword">:protocol-prop</span> <span class="boolean">true</span><span class="s-exp">}</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
                                        <span class="s-exp">(</span><span class="special-form">.</span> <span class="reader-char">~</span><span class="symbol">fsig</span> <span class="reader-char">~</span><span class="symbol">slot</span> <span class="reader-char">~@</span><span class="symbol">sig</span><span class="s-exp">)</span>
                                        <span class="s-exp">(</span><span class="reader-char">~</span><span class="symbol">dyn-name</span> <span class="reader-char">~@</span><span class="symbol">sig</span><span class="s-exp">)</span><span class="s-exp">)</span>

                                     <span class="comment">;; then check protocol fn in metadata (only when protocol is marked with :extend-via-metadata true)
</span>                                     <span class="symbol">check</span>
                                     <span class="s-exp">(</span><span class="symbol">core/if-not</span> <span class="s-exp">(</span><span class="keyword">:extend-via-metadata</span> <span class="symbol">opts</span><span class="s-exp">)</span>
                                       <span class="symbol">check</span>
                                       <span class="reader-char">`</span><span class="s-exp">(</span><span class="conditional">if-let</span> <span class="s-exp">[</span>meta-impl<span class="reader-char">#</span> <span class="s-exp">(</span><span class="macro">-></span> <span class="reader-char">~</span><span class="symbol">fsig</span> <span class="s-exp">(</span><span class="symbol">core/meta</span><span class="s-exp">)</span> <span class="s-exp">(</span><span class="symbol">core/get</span> <span class="reader-char">'</span><span class="reader-char">~</span><span class="symbol">fqn-fname</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">]</span>
                                          <span class="s-exp">(</span>meta-impl<span class="reader-char">#</span> <span class="reader-char">~@</span><span class="symbol">sig</span><span class="s-exp">)</span>
                                          <span class="reader-char">~</span><span class="symbol">check</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">]</span>
                            <span class="reader-char">`</span><span class="s-exp">(</span><span class="reader-char">~</span><span class="symbol">sig</span> <span class="reader-char">~</span><span class="symbol">check</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
             <span class="symbol">psym</span> <span class="s-exp">(</span><span class="symbol">core/-></span> <span class="symbol">psym</span>
                    <span class="s-exp">(</span><span class="core-fn">vary-meta</span> <span class="core-fn">update-in</span> <span class="s-exp">[</span><span class="keyword">:jsdoc</span><span class="s-exp">]</span> <span class="core-fn">conj</span> <span class="string">"@interface"</span><span class="s-exp">)</span>
                    <span class="s-exp">(</span><span class="core-fn">vary-meta</span> <span class="core-fn">assoc-in</span> <span class="s-exp">[</span><span class="keyword">:protocol-info</span> <span class="keyword">:methods</span><span class="s-exp">]</span>
                      <span class="s-exp">(</span><span class="core-fn">into</span> <span class="s-exp">{</span><span class="s-exp">}</span>
                        <span class="s-exp">(</span><span class="core-fn">map</span>
                          <span class="s-exp">(</span><span class="symbol">core/fn</span> <span class="s-exp">[</span><span class="s-exp">[</span><span class="symbol">fname</span> <span class="reader-char">&</span> <span class="symbol">sigs</span><span class="s-exp">]</span><span class="s-exp">]</span>
                            <span class="s-exp">(</span><span class="symbol">core/let</span> <span class="s-exp">[</span><span class="symbol">doc</span> <span class="s-exp">(</span><span class="symbol">core/as-></span> <span class="s-exp">(</span><span class="core-fn">last</span> <span class="symbol">sigs</span><span class="s-exp">)</span> <span class="symbol">doc</span>
                                             <span class="s-exp">(</span><span class="symbol">core/when</span> <span class="s-exp">(</span><span class="symbol">core/string?</span> <span class="symbol">doc</span><span class="s-exp">)</span> <span class="symbol">doc</span><span class="s-exp">)</span><span class="s-exp">)</span>
                                       <span class="symbol">sigs</span> <span class="s-exp">(</span><span class="core-fn">take-while</span> <span class="core-fn">vector?</span> <span class="symbol">sigs</span><span class="s-exp">)</span><span class="s-exp">]</span>
                              <span class="s-exp">[</span><span class="s-exp">(</span><span class="core-fn">vary-meta</span> <span class="symbol">fname</span> <span class="core-fn">assoc</span> <span class="keyword">:doc</span> <span class="symbol">doc</span><span class="s-exp">)</span>
                               <span class="s-exp">(</span><span class="core-fn">vec</span> <span class="symbol">sigs</span><span class="s-exp">)</span><span class="s-exp">]</span><span class="s-exp">)</span><span class="s-exp">)</span>
                          <span class="core-fn">methods</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
                    <span class="comment">;; for compatibility with Clojure
</span>                    <span class="s-exp">(</span><span class="core-fn">vary-meta</span> <span class="core-fn">assoc-in</span> <span class="s-exp">[</span><span class="keyword">:sigs</span><span class="s-exp">]</span>
                      <span class="s-exp">(</span><span class="core-fn">into</span> <span class="s-exp">{</span><span class="s-exp">}</span>
                        <span class="s-exp">(</span><span class="core-fn">map</span>
                          <span class="s-exp">(</span><span class="symbol">core/fn</span> <span class="s-exp">[</span><span class="s-exp">[</span><span class="symbol">fname</span> <span class="reader-char">&</span> <span class="symbol">sigs</span><span class="s-exp">]</span><span class="s-exp">]</span>
                            <span class="s-exp">(</span><span class="symbol">core/let</span> <span class="s-exp">[</span><span class="symbol">doc</span> <span class="s-exp">(</span><span class="symbol">core/as-></span> <span class="s-exp">(</span><span class="core-fn">last</span> <span class="symbol">sigs</span><span class="s-exp">)</span> <span class="symbol">doc</span>
                                             <span class="s-exp">(</span><span class="symbol">core/when</span> <span class="s-exp">(</span><span class="symbol">core/string?</span> <span class="symbol">doc</span><span class="s-exp">)</span> <span class="symbol">doc</span><span class="s-exp">)</span><span class="s-exp">)</span>
                                       <span class="symbol">sigs</span> <span class="s-exp">(</span><span class="core-fn">take-while</span> <span class="core-fn">vector?</span> <span class="symbol">sigs</span><span class="s-exp">)</span><span class="s-exp">]</span>
                              <span class="s-exp">[</span><span class="s-exp">(</span><span class="core-fn">keyword</span> <span class="symbol">fname</span><span class="s-exp">)</span> <span class="s-exp">{</span><span class="keyword">:name</span> <span class="symbol">fname</span> <span class="keyword">:arglists</span> <span class="s-exp">(</span><span class="core-fn">list*</span> <span class="symbol">sigs</span><span class="s-exp">)</span> <span class="keyword">:doc</span> <span class="symbol">doc</span><span class="s-exp">}</span><span class="s-exp">]</span><span class="s-exp">)</span><span class="s-exp">)</span>
                          <span class="core-fn">methods</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
             <span class="symbol">method</span> <span class="s-exp">(</span><span class="symbol">core/fn</span> <span class="s-exp">[</span><span class="s-exp">[</span><span class="symbol">fname</span> <span class="reader-char">&</span> <span class="symbol">sigs</span><span class="s-exp">]</span><span class="s-exp">]</span>
                      <span class="s-exp">(</span><span class="symbol">core/let</span> <span class="s-exp">[</span><span class="symbol">doc</span> <span class="s-exp">(</span><span class="symbol">core/as-></span> <span class="s-exp">(</span><span class="core-fn">last</span> <span class="symbol">sigs</span><span class="s-exp">)</span> <span class="symbol">doc</span>
                                       <span class="s-exp">(</span><span class="symbol">core/when</span> <span class="s-exp">(</span><span class="symbol">core/string?</span> <span class="symbol">doc</span><span class="s-exp">)</span> <span class="symbol">doc</span><span class="s-exp">)</span><span class="s-exp">)</span>
                                 <span class="symbol">sigs</span> <span class="s-exp">(</span><span class="core-fn">take-while</span> <span class="core-fn">vector?</span> <span class="symbol">sigs</span><span class="s-exp">)</span>
                                 <span class="symbol">amp</span> <span class="s-exp">(</span><span class="symbol">core/when</span> <span class="s-exp">(</span><span class="core-fn">some</span> <span class="s-exp">#{</span><span class="reader-char">'</span><span class="reader-char">&</span><span class="s-exp">}</span> <span class="s-exp">(</span><span class="core-fn">apply</span> <span class="core-fn">concat</span> <span class="symbol">sigs</span><span class="s-exp">)</span><span class="s-exp">)</span>
                                       <span class="s-exp">(</span><span class="symbol">cljs.analyzer/warning</span>
                                        <span class="keyword">:protocol-with-variadic-method</span>
                                        <span class="symbol">&env</span> <span class="s-exp">{</span><span class="keyword">:protocol</span> <span class="symbol">psym</span> <span class="keyword">:name</span> <span class="symbol">fname</span><span class="s-exp">}</span><span class="s-exp">)</span><span class="s-exp">)</span>
                                 <span class="symbol">_</span> <span class="s-exp">(</span><span class="symbol">core/when-some</span> <span class="s-exp">[</span><span class="symbol">existing</span> <span class="s-exp">(</span><span class="symbol">core/get</span> <span class="s-exp">(</span><span class="macro">-></span> <span class="symbol">&env</span> <span class="keyword">:ns</span> <span class="keyword">:defs</span><span class="s-exp">)</span> <span class="symbol">fname</span><span class="s-exp">)</span><span class="s-exp">]</span>
                                     <span class="s-exp">(</span><span class="symbol">core/when-not</span> <span class="s-exp">(</span><span class="core-fn">=</span> <span class="symbol">p</span> <span class="s-exp">(</span><span class="keyword">:protocol</span> <span class="symbol">existing</span><span class="s-exp">)</span><span class="s-exp">)</span>
                                       <span class="s-exp">(</span><span class="symbol">cljs.analyzer/warning</span>
                                         <span class="keyword">:protocol-with-overwriting-method</span>
                                         <span class="s-exp">{</span><span class="s-exp">}</span> <span class="s-exp">{</span><span class="keyword">:protocol</span> <span class="symbol">psym</span> <span class="keyword">:name</span> <span class="symbol">fname</span> <span class="keyword">:existing</span> <span class="symbol">existing</span><span class="s-exp">}</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
                                 <span class="symbol">slot</span> <span class="s-exp">(</span><span class="core-fn">symbol</span> <span class="s-exp">(</span><span class="symbol">core/str</span> <span class="symbol">prefix</span> <span class="s-exp">(</span><span class="core-fn">munge</span> <span class="s-exp">(</span><span class="core-fn">name</span> <span class="symbol">fname</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
                                 <span class="symbol">dyn-name</span> <span class="s-exp">(</span><span class="core-fn">symbol</span> <span class="s-exp">(</span><span class="symbol">core/str</span> <span class="symbol">slot</span> <span class="string">"$dyn"</span><span class="s-exp">)</span><span class="s-exp">)</span>
                                 <span class="symbol">fname</span> <span class="s-exp">(</span><span class="core-fn">vary-meta</span> <span class="symbol">fname</span> <span class="core-fn">assoc</span>
                                         <span class="keyword">:protocol</span> <span class="symbol">p</span>
                                         <span class="keyword">:doc</span> <span class="symbol">doc</span><span class="s-exp">)</span><span class="s-exp">]</span>
                        <span class="reader-char">`</span><span class="s-exp">(</span><span class="special-form">let</span> <span class="s-exp">[</span><span class="reader-char">~</span><span class="symbol">dyn-name</span> <span class="s-exp">(</span><span class="symbol">core/fn</span>
                                           <span class="reader-char">~@</span><span class="s-exp">(</span><span class="core-fn">map</span> <span class="s-exp">(</span><span class="symbol">core/fn</span> <span class="s-exp">[</span><span class="symbol">sig</span><span class="s-exp">]</span>
                                                    <span class="s-exp">(</span><span class="symbol">expand-dyn</span> <span class="symbol">fname</span> <span class="symbol">sig</span><span class="s-exp">)</span><span class="s-exp">)</span>
                                               <span class="symbol">sigs</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">]</span>
                           <span class="s-exp">(</span><span class="definition">defn</span> <span class="reader-char">~</span><span class="symbol">fname</span>
                             <span class="reader-char">~@</span><span class="s-exp">(</span><span class="core-fn">map</span> <span class="s-exp">(</span><span class="symbol">core/fn</span> <span class="s-exp">[</span><span class="symbol">sig</span><span class="s-exp">]</span>
                                      <span class="s-exp">(</span><span class="symbol">expand-sig</span> <span class="symbol">fname</span> <span class="symbol">dyn-name</span>
                                        <span class="s-exp">(</span><span class="core-fn">with-meta</span> <span class="s-exp">(</span><span class="core-fn">symbol</span> <span class="s-exp">(</span><span class="symbol">core/str</span> <span class="symbol">slot</span> <span class="string">"$arity$"</span> <span class="s-exp">(</span><span class="core-fn">count</span> <span class="symbol">sig</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
                                          <span class="s-exp">{</span><span class="keyword">:protocol-prop</span> <span class="boolean">true</span><span class="s-exp">}</span><span class="s-exp">)</span>
                                        <span class="symbol">sig</span><span class="s-exp">)</span><span class="s-exp">)</span>
                                 <span class="symbol">sigs</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">]</span>
    <span class="reader-char">`</span><span class="s-exp">(</span><span class="special-form">do</span>
       <span class="s-exp">(</span><span class="special-form">set!</span> <span class="reader-char">~</span><span class="reader-char">'</span><span class="symbol">*unchecked-if*</span> <span class="boolean">true</span><span class="s-exp">)</span>
       <span class="s-exp">(</span><span class="special-form">def</span> <span class="reader-char">~</span><span class="symbol">psym</span> <span class="s-exp">(</span><span class="reader-char">~</span><span class="reader-char">'</span><span class="symbol">js*</span> <span class="string">"function(){}"</span><span class="s-exp">)</span><span class="s-exp">)</span>
       <span class="reader-char">~@</span><span class="s-exp">(</span><span class="core-fn">map</span> <span class="symbol">method</span> <span class="core-fn">methods</span><span class="s-exp">)</span>
       <span class="s-exp">(</span><span class="special-form">set!</span> <span class="reader-char">~</span><span class="reader-char">'</span><span class="symbol">*unchecked-if*</span> <span class="boolean">false</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span></code></pre><hr /></div><footer class="site-footer"><div class="wrapper"><hr /><div class="cljs-legal">ClojureScript is licensed <a href="http://opensource.org/licenses/eclipse-1.0.php">EPL 1.0</a><br />Copyright Â© Rich Hickey</div></div></footer></div><script src="/js/client.js"></script></body></html>