<html><head><meta charset="utf-8" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><meta content="width=device-width, initial-scale=1" name="viewport" /><title>iteration</title><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700" rel="stylesheet" /><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet" /><link href="/css/normalize.css" rel="stylesheet" /><link href="/css/skeleton.css" rel="stylesheet" /><link href="/css/custom.css" rel="stylesheet" /><link href="/css/github-theme.css" rel="stylesheet" /><link href="/img/icons/apple-touch-icon-57x57.png" rel="apple-touch-icon" sizes="57x57" /><link href="/img/icons/apple-touch-icon-114x114.png" rel="apple-touch-icon" sizes="114x114" /><link href="/img/icons/apple-touch-icon-72x72.png" rel="apple-touch-icon" sizes="72x72" /><link href="/img/icons/apple-touch-icon-144x144.png" rel="apple-touch-icon" sizes="144x144" /><link href="/img/icons/apple-touch-icon-60x60.png" rel="apple-touch-icon" sizes="60x60" /><link href="/img/icons/apple-touch-icon-120x120.png" rel="apple-touch-icon" sizes="120x120" /><link href="/img/icons/apple-touch-icon-76x76.png" rel="apple-touch-icon" sizes="76x76" /><link href="/img/icons/apple-touch-icon-152x152.png" rel="apple-touch-icon" sizes="152x152" /><link href="/img/icons/apple-touch-icon-180x180.png" rel="apple-touch-icon" sizes="180x180" /><link href="/img/icons/favicon-192x192.png" rel="icon" sizes="192x192" type="image/png" /><link href="/img/icons/favicon-160x160.png" rel="icon" sizes="160x160" type="image/png" /><link href="/img/icons/favicon-96x96.png" rel="icon" sizes="96x96" type="image/png" /><link href="/img/icons/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" /><link href="/img/icons/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" /></head><body><div class="container"><nav class="navbar"><div class="container"><ul class="navbar-list"><li class="navbar-item"><a class="navbar-link-logo"><img class="navbar-logo" src="/img/cljs-white.svg" /></a></li><li class="navbar-item"><a class="navbar-title">ClojureScript</a></li><li class="navbar-item"><a class="navbar-link" href="/api">API</a></li><li class="navbar-item"><a class="navbar-link" href="https://github.com/clojure/clojurescript" target="_blank">GitHub</a></li></ul></div></nav><div><h1 class="r">iteration</h1><table><tr><td>function</td><td>added v1.11.50</td><td>removed v0.0-2371</td><td>added v0.0-2301</td><td><a href="https://github.com/cljs/api/blob/master/docfiles/cljs.core/iteration.md">Edit</a></td></tr></table><div><code>(iteration step & {:keys [somef vf kf initk], :or {vf identity, kf identity, somef some?, initk nil}})</code></div><hr />Source docstring:<pre>Creates a seqable/reducible via repeated calls to step,
a function of some (continuation token) 'k'. The first call to step
will be passed initk, returning 'ret'. Iff (somef ret) is true,
(vf ret) will be included in the iteration, else iteration will
terminate and vf/kf will not be called. If (kf ret) is non-nil it
will be passed to the next step call, else iteration will terminate.
This can be used e.g. to consume APIs that return paginated or batched data.
 step - (possibly impure) fn of 'k' -> 'ret'
 :somef - fn of 'ret' -> logical true/false, default 'some?'
 :vf - fn of 'ret' -> 'v', a value produced by the iteration, default 'identity'
 :kf - fn of 'ret' -> 'next-k' or nil (signaling 'do not continue'), default 'identity'
 :initk - the first value passed to step, default 'nil'
It is presumed that step with non-initk is unreproducible/non-idempotent.
If step with initk is unreproducible it is on the consumer to not consume twice.</pre><div>Source code @ <a href="https://github.com/clojure/clojurescript/blob/r1.11.60/src/main/cljs/cljs/core.cljs#L10957-L10998">clojurescript:src/main/cljs/cljs/core.cljs</a></div><pre><code class="syntax"><span class="s-exp">(</span><span class="definition">defn</span> <span class="symbol">iteration</span>
  <span class="s-exp">[</span><span class="symbol">step</span> <span class="reader-char">&</span> <span class="s-exp">{</span><span class="keyword">:keys</span> <span class="s-exp">[</span><span class="symbol">somef</span> <span class="symbol">vf</span> <span class="symbol">kf</span> <span class="symbol">initk</span><span class="s-exp">]</span>
           <span class="keyword">:or</span> <span class="s-exp">{</span><span class="symbol">vf</span> <span class="core-fn">identity</span>
                <span class="symbol">kf</span> <span class="core-fn">identity</span>
                <span class="symbol">somef</span> <span class="core-fn">some?</span>
                <span class="symbol">initk</span> <span class="nil">nil</span><span class="s-exp">}</span><span class="s-exp">}</span><span class="s-exp">]</span>
  <span class="s-exp">(</span><span class="macro">reify</span>
    <span class="symbol">ISeqable</span>
    <span class="s-exp">(</span><span class="symbol">-seq</span> <span class="s-exp">[</span><span class="symbol">_</span><span class="s-exp">]</span>
      <span class="s-exp">(</span><span class="s-exp">(</span><span class="special-form">fn</span> <span class="core-fn">next</span> <span class="s-exp">[</span><span class="symbol">ret</span><span class="s-exp">]</span>
         <span class="s-exp">(</span><span class="conditional">when</span> <span class="s-exp">(</span><span class="symbol">somef</span> <span class="symbol">ret</span><span class="s-exp">)</span>
           <span class="s-exp">(</span><span class="core-fn">cons</span> <span class="s-exp">(</span><span class="symbol">vf</span> <span class="symbol">ret</span><span class="s-exp">)</span>
             <span class="s-exp">(</span><span class="conditional">when-some</span> <span class="s-exp">[</span><span class="symbol">k</span> <span class="s-exp">(</span><span class="symbol">kf</span> <span class="symbol">ret</span><span class="s-exp">)</span><span class="s-exp">]</span>
               <span class="s-exp">(</span><span class="macro">lazy-seq</span> <span class="s-exp">(</span><span class="core-fn">next</span> <span class="s-exp">(</span><span class="symbol">step</span> <span class="symbol">k</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
       <span class="s-exp">(</span><span class="symbol">step</span> <span class="symbol">initk</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
    <span class="symbol">IReduce</span>
    <span class="s-exp">(</span><span class="symbol">-reduce</span> <span class="s-exp">[</span><span class="symbol">_</span> <span class="symbol">rf</span> <span class="symbol">init</span><span class="s-exp">]</span>
      <span class="s-exp">(</span><span class="special-form">loop</span> <span class="s-exp">[</span><span class="symbol">acc</span> <span class="symbol">init</span>
             <span class="symbol">ret</span> <span class="s-exp">(</span><span class="symbol">step</span> <span class="symbol">initk</span><span class="s-exp">)</span><span class="s-exp">]</span>
        <span class="s-exp">(</span><span class="special-form">if</span> <span class="s-exp">(</span><span class="symbol">somef</span> <span class="symbol">ret</span><span class="s-exp">)</span>
          <span class="s-exp">(</span><span class="special-form">let</span> <span class="s-exp">[</span><span class="symbol">acc</span> <span class="s-exp">(</span><span class="symbol">rf</span> <span class="symbol">acc</span> <span class="s-exp">(</span><span class="symbol">vf</span> <span class="symbol">ret</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">]</span>
            <span class="s-exp">(</span><span class="special-form">if</span> <span class="s-exp">(</span><span class="core-fn">reduced?</span> <span class="symbol">acc</span><span class="s-exp">)</span>
              <span class="reader-char">@</span><span class="symbol">acc</span>
              <span class="s-exp">(</span><span class="conditional">if-some</span> <span class="s-exp">[</span><span class="symbol">k</span> <span class="s-exp">(</span><span class="symbol">kf</span> <span class="symbol">ret</span><span class="s-exp">)</span><span class="s-exp">]</span>
                <span class="s-exp">(</span><span class="special-form">recur</span> <span class="symbol">acc</span> <span class="s-exp">(</span><span class="symbol">step</span> <span class="symbol">k</span><span class="s-exp">)</span><span class="s-exp">)</span>
                <span class="symbol">acc</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span>
          <span class="symbol">acc</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span><span class="s-exp">)</span></code></pre><hr /></div><footer class="site-footer"><div class="wrapper"><hr /><div class="cljs-legal">ClojureScript is licensed <a href="http://opensource.org/licenses/eclipse-1.0.php">EPL 1.0</a><br />Copyright Â© Rich Hickey</div></div></footer></div><script src="/js/client.js"></script></body></html>