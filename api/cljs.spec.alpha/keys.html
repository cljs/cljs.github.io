<html><head><meta charset="utf-8" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><meta content="width=device-width, initial-scale=1" name="viewport" /><title>CLJS - cljs.spec.alpha/keys</title><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700" rel="stylesheet" /><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet" /><link href="/css/normalize.css" rel="stylesheet" /><link href="/css/skeleton.css" rel="stylesheet" /><link href="/css/custom.css" rel="stylesheet" /><link href="/css/github-theme.css" rel="stylesheet" /><link href="/img/icons/apple-touch-icon-57x57.png" rel="apple-touch-icon" sizes="57x57" /><link href="/img/icons/apple-touch-icon-114x114.png" rel="apple-touch-icon" sizes="114x114" /><link href="/img/icons/apple-touch-icon-72x72.png" rel="apple-touch-icon" sizes="72x72" /><link href="/img/icons/apple-touch-icon-144x144.png" rel="apple-touch-icon" sizes="144x144" /><link href="/img/icons/apple-touch-icon-60x60.png" rel="apple-touch-icon" sizes="60x60" /><link href="/img/icons/apple-touch-icon-120x120.png" rel="apple-touch-icon" sizes="120x120" /><link href="/img/icons/apple-touch-icon-76x76.png" rel="apple-touch-icon" sizes="76x76" /><link href="/img/icons/apple-touch-icon-152x152.png" rel="apple-touch-icon" sizes="152x152" /><link href="/img/icons/apple-touch-icon-180x180.png" rel="apple-touch-icon" sizes="180x180" /><link href="/img/icons/favicon-192x192.png" rel="icon" sizes="192x192" type="image/png" /><link href="/img/icons/favicon-160x160.png" rel="icon" sizes="160x160" type="image/png" /><link href="/img/icons/favicon-96x96.png" rel="icon" sizes="96x96" type="image/png" /><link href="/img/icons/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" /><link href="/img/icons/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" /></head><body><div class="container"><nav class="navbar"><div class="container"><ul class="navbar-list"><li class="navbar-item"><a class="navbar-link-logo"><img class="navbar-logo" src="/img/cljs-white.svg" /></a></li><li class="navbar-item"><a class="navbar-title">ClojureScript</a></li><li class="navbar-item"><a class="navbar-link" href="/api">API</a></li><li class="navbar-item"><a class="navbar-link" href="/news">News</a></li><li class="navbar-item"><a class="navbar-link" href="https://github.com/clojure/clojurescript" target="_blank">GitHub</a></li></ul></div></nav><div><h1 class="r">cljs.spec.alpha/keys</h1><table><tr><td>macro</td><td>Added in 1.9.542</td><td><a href="https://github.com/cljs/api/blob/master/docfiles/cljs.spec.alpha/keys.md">Edit</a></td></tr></table><div><code>(keys & {:keys [req req-un opt opt-un gen]})</code></div><hr />Source docstring:<pre>Creates and returns a map validating spec. :req and :opt are both
vectors of namespaced-qualified keywords. The validator will ensure
the :req keys are present. The :opt keys serve as documentation and
may be used by the generator.

The :req key vector supports 'and' and 'or' for key groups:

(s/keys :req [::x ::y (or ::secret (and ::user ::pwd))] :opt [::z])

There are also -un versions of :req and :opt. These allow
you to connect unqualified keys to specs.  In each case, fully
qualfied keywords are passed, which name the specs, but unqualified
keys (with the same name component) are expected and checked at
conform-time, and generated during gen:

(s/keys :req-un [:my.ns/x :my.ns/y])

The above says keys :x and :y are required, and will be validated
and generated by specs (if they exist) named :my.ns/x :my.ns/y
respectively.

In addition, the values of *all* namespace-qualified keys will be validated
(and possibly destructured) by any registered specs. Note: there is
no support for inline value specification, by design.

Optionally takes :gen generator-fn, which must be a fn of no args that
returns a test.check generator.</pre><div>Source code @ <a href="https://github.com/clojure/clojurescript/blob/r1.9.542-1-gd93c435/src/main/cljs/cljs/spec/alpha.cljc#L122-L182">clojurescript:src/main/cljs/cljs/spec/alpha.cljc</a></div><pre><code>(<span class="hljs-name"><span class="hljs-builtin-name">defmacro</span></span> keys
  [&amp; {<span class="hljs-symbol">:keys</span> [req req-un opt opt-un gen]}]
  (<span class="hljs-name"><span class="hljs-builtin-name">let</span></span> [unk #(<span class="hljs-name"><span class="hljs-builtin-name">-&gt;</span></span> % name keyword)
        req-keys (<span class="hljs-name"><span class="hljs-builtin-name">filterv</span></span> keyword? (<span class="hljs-name"><span class="hljs-builtin-name">flatten</span></span> req))
        req-un-specs (<span class="hljs-name"><span class="hljs-builtin-name">filterv</span></span> keyword? (<span class="hljs-name"><span class="hljs-builtin-name">flatten</span></span> req-un))
        _ (<span class="hljs-name">clojure.core/assert</span> (<span class="hljs-name">every?</span> #(<span class="hljs-name">clojure.core/and</span> (<span class="hljs-name"><span class="hljs-builtin-name">keyword?</span></span> %) (<span class="hljs-name"><span class="hljs-builtin-name">namespace</span></span> %)) (<span class="hljs-name"><span class="hljs-builtin-name">concat</span></span> req-keys req-un-specs opt opt-un))
                  <span class="hljs-string">"all keys must be namespace-qualified keywords"</span>)
        req-specs (<span class="hljs-name"><span class="hljs-builtin-name">into</span></span> req-keys req-un-specs)
        req-keys (<span class="hljs-name"><span class="hljs-builtin-name">into</span></span> req-keys (<span class="hljs-name"><span class="hljs-builtin-name">map</span></span> unk req-un-specs))
        opt-keys (<span class="hljs-name"><span class="hljs-builtin-name">into</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">vec</span></span> opt) (<span class="hljs-name"><span class="hljs-builtin-name">map</span></span> unk opt-un))
        opt-specs (<span class="hljs-name"><span class="hljs-builtin-name">into</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">vec</span></span> opt) opt-un)
        gx (<span class="hljs-name"><span class="hljs-builtin-name">gensym</span></span>)
        parse-req (<span class="hljs-name"><span class="hljs-builtin-name">fn</span></span> [rk f]
                    (<span class="hljs-name"><span class="hljs-builtin-name">map</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">fn</span></span> [x]
                           (<span class="hljs-name"><span class="hljs-builtin-name">if</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">keyword?</span></span> x)
                             `(<span class="hljs-name"><span class="hljs-builtin-name">contains?</span></span> ~gx ~(<span class="hljs-name">f</span> x))
                             (<span class="hljs-name">walk/postwalk</span>
                               (<span class="hljs-name"><span class="hljs-builtin-name">fn</span></span> [y] (<span class="hljs-name"><span class="hljs-builtin-name">if</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">keyword?</span></span> y) `(<span class="hljs-name"><span class="hljs-builtin-name">contains?</span></span> ~gx ~(<span class="hljs-name">f</span> y)) y))
                               x)))
                         rk))
        pred-exprs [`(<span class="hljs-name"><span class="hljs-builtin-name">map?</span></span> ~gx)]
        pred-exprs (<span class="hljs-name"><span class="hljs-builtin-name">into</span></span> pred-exprs (<span class="hljs-name">parse-req</span> req identity))
        pred-exprs (<span class="hljs-name"><span class="hljs-builtin-name">into</span></span> pred-exprs (<span class="hljs-name">parse-req</span> req-un unk))
        keys-pred `(<span class="hljs-name">fn*</span> [~gx] (<span class="hljs-name">c/and</span> ~@pred-exprs))
        pred-exprs (<span class="hljs-name"><span class="hljs-builtin-name">mapv</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">fn</span></span> [e] `(<span class="hljs-name">fn*</span> [~gx] ~e)) pred-exprs)
        pred-forms (<span class="hljs-name">walk/postwalk</span> #(<span class="hljs-name">res</span> &amp;env %) pred-exprs)]
    <span class="hljs-comment">;; `(map-spec-impl ~req-keys '~req ~opt '~pred-forms ~pred-exprs ~gen)</span>
    `(<span class="hljs-name">map-spec-impl</span> {<span class="hljs-symbol">:req</span> '~req <span class="hljs-symbol">:opt</span> '~opt <span class="hljs-symbol">:req-un</span> '~req-un <span class="hljs-symbol">:opt-un</span> '~opt-un
                     <span class="hljs-symbol">:req-keys</span> '~req-keys <span class="hljs-symbol">:req-specs</span> '~req-specs
                     <span class="hljs-symbol">:opt-keys</span> '~opt-keys <span class="hljs-symbol">:opt-specs</span> '~opt-specs
                     <span class="hljs-symbol">:pred-forms</span> '~pred-forms
                     <span class="hljs-symbol">:pred-exprs</span> ~pred-exprs
                     <span class="hljs-symbol">:keys-pred</span> ~keys-pred
                     <span class="hljs-symbol">:gfn</span> ~gen})))</code></pre><hr /></div><footer class="site-footer"><div class="wrapper"><hr /><div class="cljs-legal">ClojureScript is licensed <a href="http://opensource.org/licenses/eclipse-1.0.php">EPL 1.0</a><br />Copyright Â© Rich Hickey</div></div></footer></div><script src="/js/client.js"></script></body></html>